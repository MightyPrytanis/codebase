<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LexFiat Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* SwimMeet Glass-Ocean base colors - darker and more saturated for Piquette */
            --ocean-deep: #0A1A2A;
            --ocean-mid: #1E3A5F;
            --steel-blue: #2C5282;
            --glass-blue: #3B82F6;
            --electric-purple: #A855F7;
            --cyber-green: #10B981;
            --neon-orange: #F59E0B;
            --gold: #D4AF37;
            --white: #FFFFFF;
            --mist: #F8FAFC;
            --steel-gray: #94A3B8;
            --chrome: #E2E8F0;
            --panel-glass: rgba(255, 255, 255, 0.08);
            --panel-border: rgba(255, 255, 255, 0.15);
            --accent-glow: rgba(59, 130, 246, 0.2);
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #2a2e35;
            color: var(--white);
            min-height: 100vh;
            position: relative;
        }

        /* Simple gray background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: -1;
            background: #2a2a2a;
        }

        /* Subtle caustic lighting overlay - static, no flashes */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 1;
            opacity: 0.4;
            background: 
                radial-gradient(ellipse 1000px 800px at 20% 30%, rgba(59, 130, 246, 0.25) 0%, rgba(59, 130, 246, 0.1) 30%, transparent 60%),
                radial-gradient(ellipse 900px 900px at 80% 60%, rgba(168, 85, 247, 0.2) 0%, rgba(168, 85, 247, 0.08) 30%, transparent 60%),
                radial-gradient(ellipse 800px 700px at 50% 85%, rgba(16, 185, 129, 0.18) 0%, rgba(16, 185, 129, 0.06) 30%, transparent 60%);
            mix-blend-mode: screen;
        }

        /* Arc welder flashes removed - shelved for future update */

        /* Header */
        .header {
            background: linear-gradient(135deg, rgba(30, 58, 95, 0.9) 0%, rgba(44, 82, 130, 0.95) 100%);
            -webkit-backdrop-filter: blur(20px) saturate(120%);
            backdrop-filter: blur(20px) saturate(120%);
            border-bottom: 2px solid var(--panel-border);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
            padding: 1rem 1.5rem;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            max-width: unset;
            margin: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            width: auto;
            justify-content: flex-start;
        }

        .logo-text-container {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            text-align: left;
            width: 260px; /* fixed width to prevent layout shift */
        }

        .logo {
            font-size: 2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo-container {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid var(--gold);
            padding: 0; /* remove inner gap */
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden; /* clip to ring */
            position: relative;
        }

        /* Subtle color overlay to shift blues toward header blue, preserving ring */
        .logo-container::after { content: none; display: none; }

        .logo-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
            border-radius: 50%;
            display: block;
            transform: scale(1.40);
            transform-origin: center center;
        }

        .logo svg {
            width: 40px;
            height: 40px;
        }

        .logo-text {
            font-family: 'DIN Next', 'DINNext LT Pro', 'DINNextLTPro', 'DIN 2014', 'D-DIN', 'DIN', 'Helvetica Neue', Arial, sans-serif;
            font-size: 2.5rem;
            font-weight: 800;
            letter-spacing: 1px;
            text-transform: none;
            color: #FFFFFF;
            margin: 0;
        }

        #rotating-slogan {
            font-style: italic;
            font-size: 0.9rem;
            color: var(--gold);
            margin: 0;
            transition: opacity 0.3s ease-in-out;
            white-space: nowrap;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .status-pills {
            display: flex;
            gap: 1rem;
        }

        .status-pill {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.25rem;
            background: rgba(30, 58, 95, 0.7);
            border-radius: 25px;
            border: 1px solid rgba(148, 163, 184, 0.2);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .status-pill:hover {
            background: rgba(30, 58, 95, 0.9);
            border-color: var(--glass-blue);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        .status-dot.success { background: var(--cyber-green); }
        .status-dot.processing { background: var(--glass-blue); }
        .status-dot.warning { background: var(--neon-orange); }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Avatar */
        .avatar-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid var(--gold);
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--ocean-mid);
        }

        .avatar:hover {
            border-color: var(--glass-blue);
            transform: scale(1.05);
        }

        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            aspect-ratio: 1/1;
        }

        .attorney-info {
            display: flex;
            flex-direction: column;
        }

        .attorney-name {
            font-size: 0.9rem;
            font-weight: 500;
        }

        .attorney-title {
            font-size: 0.75rem;
            color: var(--steel-gray);
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 0.75rem;
        }

        .action-btn {
            padding: 0.75rem 1rem;
            background: rgba(30, 58, 95, 0.7);
            border: 1px solid var(--panel-border);
            border-radius: 0;
            color: var(--white);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .action-btn:hover {
            background: var(--accent-glow);
            border-color: var(--glass-blue);
        }

        .action-btn.admin {
            background: rgba(245, 158, 11, 0.3);
            border-color: var(--neon-orange);
        }

        .action-btn.admin:hover {
            background: rgba(245, 158, 11, 0.5);
        }

        /* Main Content - LOWER Z-INDEX SO CAUSTICS SHOW */
        .main-content {
            max-width: 1600px;
            margin: 0 auto;
            padding: 0.5rem;
            position: relative;
            z-index: 5;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .page-title {
            font-size: 2rem;
            font-weight: 300;
            letter-spacing: 1px;
        }

        /* Priority Ticker - BRICK RED (matte) */
        .priority-ticker {
            background: #B35C5C !important; /* darker desert red */
            border: 4px solid #9E4B4B !important;
            border-left: 8px solid #8F3F3F !important;
            border-radius: 0;
            padding: 0.5rem 1rem;
            margin-bottom: 0.5rem;
            position: relative;
            overflow: hidden;
        }

        .ticker-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #FFFFFF;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-shadow: none; /* matte */
        }

        .ticker-content {
            height: 42px;
            position: relative;
            overflow: hidden;
        }

        .ticker-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.5rem; /* tighter */
            background: #B56C6C !important; /* darker inner */
            border-radius: 4px;
            border-left: 4px solid #9E4B4B !important; /* uniform darker desert red */
            transition: all 0.2s ease;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            opacity: 0;
            transform: translateY(20px);
            cursor: pointer;
            color: #FFFFFF;
            font-weight: 600;
            text-shadow: none; /* matte */
            backdrop-filter: none;
            box-shadow: none;
        }

        .ticker-item.active {
            opacity: 1;
            transform: translateY(0);
        }

        /* Priority Ticker Glass Surface Effects */
        .priority-ticker::before,
        .priority-ticker::after { content: none !important; }

        /* Priority Ticker Glass Reflection Lines */
        .priority-ticker::after { content: none !important; display: none !important; }

        .ticker-item:hover {
            background: #AA6161 !important;
            transform: translateY(0);
        }

        /* Tracking Card */
        .tracking-card-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .tracking-card {
            background: linear-gradient(135deg, rgba(30, 58, 95, 0.95) 0%, rgba(10, 26, 42, 0.95) 100%);
            border: 1px solid var(--panel-border);
            border-radius: 8px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }

        .tracking-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--panel-border);
        }

        .tracking-card-title {
            font-size: 1.5rem;
            font-weight: 500;
            color: var(--white);
        }

        .close-tracking-card {
            background: none;
            border: none;
            color: var(--steel-gray);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-tracking-card:hover {
            color: var(--white);
        }

        .tracking-card-content {
            display: grid;
            gap: 1.5rem;
        }

        .tracking-section {
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem;
            border-radius: 4px;
            border-left: 3px solid var(--glass-blue);
        }

        .tracking-section h4 {
            margin: 0 0 0.75rem 0;
            color: var(--chrome);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .tracking-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .tracking-row:last-child {
            margin-bottom: 0;
        }

        .tracking-label {
            color: var(--steel-gray);
            font-size: 0.9rem;
        }

        .tracking-value {
            color: var(--white);
            font-weight: 500;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-badge.critical {
            background: rgba(220, 38, 38, 0.2);
            color: #FCA5A5;
            border: 1px solid #DC2626;
        }

        .status-badge.high {
            background: rgba(245, 158, 11, 0.2);
            color: #FCD34D;
            border: 1px solid #F59E0B;
        }

        .status-badge.medium {
            background: rgba(59, 130, 246, 0.2);
            color: #93C5FD;
            border: 1px solid #3B82F6;
        }

        .status-badge.low {
            background: rgba(16, 185, 129, 0.2);
            color: #6EE7B7;
            border: 1px solid #10B981;
        }

        .workflow-progress {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .workflow-stage {
            padding: 0.5rem 1rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
            font-size: 0.8rem;
            color: var(--steel-gray);
        }

        .workflow-stage.completed {
            background: rgba(16, 185, 129, 0.2);
            color: #6EE7B7;
        }

        .workflow-stage.current {
            background: rgba(59, 130, 246, 0.2);
            color: #93C5FD;
        }

        .workflow-stage.pending {
            background: rgba(0, 0, 0, 0.2);
            color: var(--steel-gray);
        }


        .ticker-item.critical {
            border-left-color: #DC2626;
        }

        .ticker-item.high {
            border-left-color: #F59E0B;
        }

        .ticker-item.medium {
            border-left-color: #3B82F6;
        }

        .ticker-item.low {
            border-left-color: #10B981;
        }

        .alert-icon {
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .alert-text {
            flex: 1;
            font-size: 0.9rem;
            color: var(--white);
        }

        .alert-time {
            font-size: 0.8rem;
            color: #E5E7EB; /* higher contrast */
            font-weight: 600;
            flex-shrink: 0;
        }

        /* Workflow Notification */
        .workflow-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.9) 0%, rgba(5, 150, 105, 0.9) 100%);
            border: 1px solid var(--cyber-green);
            border-radius: 8px;
            padding: 1rem;
            min-width: 300px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            animation: slideInRight 0.3s ease-out;
        }

        .workflow-notification.error {
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.9) 0%, rgba(185, 28, 28, 0.9) 100%);
            border-color: #DC2626;
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .notification-icon {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--white);
        }

        .notification-text {
            flex: 1;
            color: var(--white);
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .notification-close {
            background: none;
            border: none;
            color: var(--white);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s ease;
        }

        .notification-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Assembly Line Container */
        .assembly-line {
            margin-bottom: 3rem;
            position: relative;
        }

        .assembly-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .assembly-title {
            font-size: 1.5rem;
            font-weight: 300;
            letter-spacing: 1px;
            color: var(--chrome);
            margin: 0;
        }

        .widget-controls {
            display: flex;
            gap: 1rem;
        }

        .control-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            background: rgba(30, 58, 95, 0.7);
            border: 1px solid var(--panel-border);
            border-radius: 0;
            color: var(--white);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.85rem;
        }

        .control-btn:hover {
            background: var(--accent-glow);
            border-color: var(--glass-blue);
        }

        .control-icon {
            font-size: 1.1rem;
            font-weight: bold;
        }

        /* Widget Menu */
        .widget-menu {
            position: absolute;
            top: 100%;
            right: 0;
            width: 500px;
            background: linear-gradient(135deg, rgba(30, 58, 95, 0.95) 0%, rgba(10, 26, 42, 0.95) 100%);
            border: 1px solid var(--panel-border);
            border-radius: 8px;
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            z-index: 100;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }

        .widget-menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--panel-border);
        }

        .widget-menu-header h3 {
            margin: 0;
            font-size: 1.1rem;
            color: var(--white);
        }

        .close-menu {
            background: none;
            border: none;
            color: var(--steel-gray);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-menu:hover {
            color: var(--white);
        }

        .widget-menu-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            padding: 1.5rem;
        }

        .available-widgets h4,
        .current-widgets h4 {
            margin: 0 0 1rem 0;
            font-size: 0.9rem;
            color: var(--steel-gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .widget-option {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid transparent;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 0.5rem;
        }

        .widget-option:hover {
            background: rgba(0, 0, 0, 0.3);
            border-color: var(--glass-blue);
        }

        .widget-icon {
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .widget-name {
            font-weight: 500;
            color: var(--white);
            flex: 1;
        }

        .widget-desc {
            font-size: 0.8rem;
            color: var(--steel-gray);
        }

        .current-widget-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--panel-border);
            border-radius: 4px;
            margin-bottom: 0.5rem;
        }

        .remove-widget {
            background: none;
            border: none;
            color: #ef4444;
            cursor: pointer;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s ease;
        }

        .remove-widget:hover {
            background: rgba(239, 68, 68, 0.2);
        }

        /* Workflow Pipeline - Horizontal with connecting lines */
        .workflow-pipeline {
            display: flex;
            gap: 1rem;
            align-items: stretch;
            position: relative;
            padding: 2rem 0;
            overflow-x: visible;
            flex-wrap: wrap;
            justify-content: flex-start;
        }

        /* Responsive workflow - ensure all widgets fit */
        @media (max-width: 1600px) {
            .workflow-pipeline {
                gap: 0.75rem;
            }
        }

        @media (max-width: 1200px) {
            .workflow-pipeline {
                gap: 0.5rem;
            }
        }

        /* Workflow Stage Widget - Rich Etched Glass Panels */
        .workflow-stage {
            flex: 1 1 250px;
            min-width: 200px;
            max-width: 400px;
            background: 
                linear-gradient(135deg, 
                    rgba(255, 255, 255, 0.12) 0%, 
                    rgba(255, 255, 255, 0.08) 25%, 
                    rgba(255, 255, 255, 0.15) 50%, 
                    rgba(255, 255, 255, 0.06) 75%, 
                    rgba(255, 255, 255, 0.10) 100%),
                linear-gradient(45deg, 
                    rgba(59, 130, 246, 0.08) 0%, 
                    rgba(16, 185, 129, 0.06) 25%, 
                    rgba(168, 85, 247, 0.05) 50%, 
                    rgba(245, 158, 11, 0.07) 75%, 
                    rgba(239, 68, 68, 0.04) 100%),
                #0a0e13;
            -webkit-backdrop-filter: blur(60px) saturate(180%) brightness(1.2) contrast(1.1);
            backdrop-filter: blur(60px) saturate(180%) brightness(1.2) contrast(1.1);
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-top: 4px solid rgba(255, 255, 255, 0.25);
            border-radius: 0;
            padding: 1rem;
            position: relative;
            cursor: move;
            transition: all 0.3s ease;
            overflow: visible; /* allow connector to render above */
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.4),
                0 4px 16px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                inset 0 -1px 0 rgba(0, 0, 0, 0.3),
                inset 1px 0 0 rgba(255, 255, 255, 0.1),
                inset -1px 0 0 rgba(0, 0, 0, 0.2);
            resize: both;
            margin-top: 60px; /* Space for track connector */
        }

        .stage-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .stage-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin: 0 0 0.5rem 0;
            color: var(--white);
        }

        .stage-description {
            font-size: 0.9rem;
            color: var(--steel-gray);
            margin: 0 0 1rem 0;
        }

        .stage-metrics {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .metric-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
        }

        .metric-label {
            color: var(--steel-gray);
        }

        .metric-value {
            font-weight: 600;
            font-family: 'Courier New', monospace;
            color: var(--white);
        }

        /* Mechanical Track Connector (Trolley/Shuttle) */
        .workflow-stage .track-connector {
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 60px;
            background: linear-gradient(180deg, 
                #8B4513 0%, 
                #A0522D 20%, 
                #8B4513 40%, 
                #A0522D 60%, 
                #8B4513 80%, 
                #A0522D 100%);
            border-radius: 15px 15px 0 0;
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.9),
                inset 0 2px 4px rgba(255, 255, 255, 0.5),
                inset 0 -2px 4px rgba(0, 0, 0, 0.6);
            z-index: 1000;
            border: 2px solid rgba(139, 69, 19, 1);
        }

        /* Track Shoe/Clamp */
        .workflow-stage .track-shoe {
            position: absolute;
            top: -55px;
            left: 50%;
            transform: translateX(-50%);
            width: 28px;
            height: 10px;
            background: linear-gradient(90deg, 
                #8B4513 0%, 
                #A0522D 25%, 
                #8B4513 50%, 
                #A0522D 75%, 
                #8B4513 100%);
            border-radius: 5px;
            box-shadow: 
                0 2px 4px rgba(0, 0, 0, 0.8),
                inset 0 1px 2px rgba(255, 255, 255, 0.4),
                inset 0 -1px 2px rgba(0, 0, 0, 0.5);
            z-index: 1001;
            border: 1px solid rgba(160, 82, 45, 0.9);
        }

        /* Resize handle for workflow stages */
        .workflow-stage .resize-handle {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 20px;
            height: 20px;
            background: linear-gradient(-45deg, transparent 30%, rgba(255, 255, 255, 0.3) 30%, rgba(255, 255, 255, 0.3) 40%, transparent 40%, transparent 60%, rgba(255, 255, 255, 0.3) 60%, rgba(255, 255, 255, 0.3) 70%, transparent 70%);
            cursor: se-resize;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .workflow-stage:hover .resize-handle {
            opacity: 1;
        }

        /* Etched Glass Surface Effects */
        .workflow-stage .glass-surface {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                linear-gradient(135deg, 
                    rgba(255, 255, 255, 0.1) 0%, 
                    transparent 30%, 
                    rgba(255, 255, 255, 0.05) 60%, 
                    transparent 100%),
                repeating-linear-gradient(
                    90deg,
                    transparent 0px,
                    transparent 1px,
                    rgba(255, 255, 255, 0.02) 2px,
                    rgba(255, 255, 255, 0.02) 3px,
                    transparent 4px
                );
            pointer-events: none;
            z-index: 10;
            border-radius: inherit;
        }

        /* Glass Reflection Lines */
        .workflow-stage .glass-reflection {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.4) 20%, 
                rgba(255, 255, 255, 0.6) 50%, 
                rgba(255, 255, 255, 0.4) 80%, 
                transparent 100%);
            pointer-events: none;
            z-index: 11;
        }

        .workflow-stage:hover {
            transform: translateY(-4px);
            box-shadow: 
                0 8px 25px rgba(0, 0, 0, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.5),
                inset 0 -1px 0 rgba(0, 0, 0, 0.5);
        }

        .workflow-stage.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        /* Color tints for different stage types - more visible */
        .workflow-stage.intake {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.25) 0%, rgba(59, 130, 246, 0.12) 100%);
            border-left: 4px solid var(--glass-blue);
            border-top: 1px solid rgba(59, 130, 246, 0.3);
        }

        .workflow-stage.analysis {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.25) 0%, rgba(168, 85, 247, 0.12) 100%);
            border-left: 4px solid var(--electric-purple);
            border-top: 1px solid rgba(168, 85, 247, 0.3);
        }

        .workflow-stage.review {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.25) 0%, rgba(16, 185, 129, 0.12) 100%);
            border-left: 4px solid var(--cyber-green);
            border-top: 1px solid rgba(16, 185, 129, 0.3);
        }

        .workflow-stage.output {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.25) 0%, rgba(245, 158, 11, 0.12) 100%);
            border-left: 4px solid var(--neon-orange);
            border-top: 1px solid rgba(245, 158, 11, 0.3);
        }

        /* Glass reflection effect on top half - Toned down for contrast */
        .workflow-stage::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 75%;
            background: linear-gradient(
                to bottom, 
                rgba(255, 255, 255, 0.4) 0%, 
                rgba(255, 255, 255, 0.22) 30%, 
                rgba(255, 255, 255, 0.08) 60%,
                transparent 100%
            );
            pointer-events: none;
            z-index: 10;
            transition: background 0.3s ease;
        }

        /* Glossy highlight stripe at top - Toned down for contrast */
        .workflow-stage::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: 
                linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.7) 50%, transparent 100%),
                linear-gradient(to bottom, rgba(255, 255, 255, 0.65), rgba(255, 255, 255, 0.4));
            box-shadow: 
                0 2px 8px rgba(255, 255, 255, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.7);
            pointer-events: none;
            z-index: 11;
            transition: all 0.3s ease;
        }

        /* Hover state - 50% brighter */
        .workflow-stage:hover::before {
            background: linear-gradient(
                to bottom, 
                rgba(255, 255, 255, 0.9) 0%, 
                rgba(255, 255, 255, 0.53) 30%, 
                rgba(255, 255, 255, 0.23) 60%,
                transparent 100%
            );
        }

        .workflow-stage:hover::after {
            height: 10px;
            background: 
                linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 1) 50%, transparent 100%),
                linear-gradient(to bottom, rgba(255, 255, 255, 1), rgba(255, 255, 255, 1));
            box-shadow: 
                0 5px 20px rgba(255, 255, 255, 1),
                0 0 30px rgba(255, 255, 255, 0.8),
                inset 0 1px 0 rgba(255, 255, 255, 1);
        }

        /* Ensure workflow stage content appears above glass effects */
        .workflow-stage > * {
            position: relative;
            z-index: 12;
        }

        .stage-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .stage-title {
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            letter-spacing: 0.5px;
        }

        .stage-description {
            font-size: 0.85rem;
            color: var(--steel-gray);
            margin-bottom: 1rem;
        }

        .stage-metrics {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .metric-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
        }

        .metric-label {
            color: var(--steel-gray);
        }

        .metric-value {
            font-weight: 600;
            font-family: 'Courier New', monospace;
        }

        .expand-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--panel-border);
            border-radius: 0;
            padding: 0.5rem;
            cursor: pointer;
            color: var(--chrome);
            transition: all 0.2s ease;
        }

        .expand-btn:hover {
            background: var(--accent-glow);
            border-color: var(--glass-blue);
        }

        .remove-widget {
            position: absolute;
            top: 1rem;
            right: 3rem;
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
            border-radius: 0;
            padding: 0.5rem;
            cursor: pointer;
            color: #ef4444;
            transition: all 0.2s ease;
            font-size: 0.75rem;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .remove-widget:hover {
            background: rgba(239, 68, 68, 0.4);
            border-color: #dc2626;
            color: #dc2626;
        }

        /* Connecting Lines - SVG arrows between stages */
        .connector-line {
            position: absolute;
            top: 50%;
            height: 3px;
            background: linear-gradient(90deg, var(--glass-blue), var(--electric-purple), var(--cyber-green));
            opacity: 0.6;
            pointer-events: none;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }

        .connector-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            color: var(--glass-blue);
            font-size: 1.5rem;
            text-shadow: 0 0 10px rgba(59, 130, 246, 0.8);
            pointer-events: none;
        }

        /* Bottom Widgets Grid - Custom layout */
        .widgets-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        @media (max-width: 1200px) {
            .widgets-grid {
                grid-template-columns: 1fr 1fr;
            }
            .widget.performance {
                grid-column: span 2;
            }
        }

        @media (max-width: 768px) {
            .widgets-grid {
                grid-template-columns: 1fr;
            }
            .widget.performance {
                grid-column: span 1;
            }
        }

        .widget {
            background: 
                linear-gradient(135deg, rgba(255, 255, 255, 0.25) 0%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.22) 100%),
                linear-gradient(to bottom, rgba(255, 255, 255, 0.18), rgba(0, 0, 0, 0.25)),
                #0f1419;
            -webkit-backdrop-filter: blur(40px) saturate(200%) brightness(1.15);
            backdrop-filter: blur(40px) saturate(200%) brightness(1.15);
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-top: 3px solid rgba(255, 255, 255, 0.7);
            border-radius: 0;
            padding: 0.75rem; /* tighter */
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.7),
                inset 0 2px 0 rgba(255, 255, 255, 0.6),
                inset 0 -2px 0 rgba(0, 0, 0, 0.6),
                0 0 40px rgba(59, 130, 246, 0.1);
            resize: both;
        }

        /* Widget Controls */
        .widget-controls {
            display: flex;
            gap: 0.5rem;
            margin-left: auto;
        }

        .widget-toggle, .widget-resize {
            width: 24px;
            height: 24px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(0, 0, 0, 0.3);
            color: var(--white);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            transition: all 0.2s ease;
        }

        .widget-toggle:hover, .widget-resize:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: var(--glass-blue);
        }

        /* Widget positioning rules */
        .widget.workflow-widget {
            /* Workflow widgets cannot be moved out of shop floor */
            position: relative;
        }

        .widget.priority-widget, .widget.goodcounsel-widget, .widget.focus-widget {
            /* These can be resized but not turned off or moved into shop floor */
            position: relative;
        }

        .widget.secondary-widget {
            /* These can be resized, moved, turned off/on, but not moved into shop floor */
            position: relative;
        }

        /* Glass reflection effect on top half - Toned down for contrast */
        .widget::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 75%;
            background: linear-gradient(
                to bottom, 
                rgba(255, 255, 255, 0.4) 0%, 
                rgba(255, 255, 255, 0.22) 30%, 
                rgba(255, 255, 255, 0.08) 60%,
                transparent 100%
            );
            pointer-events: none;
            z-index: 10;
            transition: background 0.3s ease;
        }

        /* Glossy highlight stripe - Toned down for contrast */
        .widget::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: 
                linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.7) 50%, transparent 100%),
                linear-gradient(to bottom, rgba(255, 255, 255, 0.65), rgba(255, 255, 255, 0.4));
            box-shadow: 
                0 2px 8px rgba(255, 255, 255, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.7);
            pointer-events: none;
            z-index: 11;
            transition: all 0.3s ease;
        }

        /* Hover state - 50% brighter */
        .widget:hover::before {
            background: linear-gradient(
                to bottom, 
                rgba(255, 255, 255, 0.9) 0%, 
                rgba(255, 255, 255, 0.53) 30%, 
                rgba(255, 255, 255, 0.23) 60%,
                transparent 100%
            );
        }

        .widget:hover::after {
            height: 10px;
            background: 
                linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 1) 50%, transparent 100%),
                linear-gradient(to bottom, rgba(255, 255, 255, 1), rgba(255, 255, 255, 1));
            box-shadow: 
                0 5px 20px rgba(255, 255, 255, 1),
                0 0 30px rgba(255, 255, 255, 0.8),
                inset 0 1px 0 rgba(255, 255, 255, 1);
        }

        .widget:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 8px 25px rgba(0, 0, 0, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.5),
                inset 0 -1px 0 rgba(0, 0, 0, 0.5);
        }

        /* Ensure widget content appears above glass effects */
        .widget > * {
            position: relative;
            z-index: 12;
        }

        /* GoodCounsel Widget - METALLIC GOLD WAFER - more visible tint */
        .widget.goodcounsel {
            background: 
                linear-gradient(135deg, rgba(255, 215, 0, 0.6) 0%, rgba(212, 175, 55, 0.5) 50%, rgba(184, 134, 11, 0.6) 100%),
                linear-gradient(to right, rgba(255, 223, 0, 0.3), rgba(255, 215, 0, 0.5), rgba(255, 223, 0, 0.3));
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            backdrop-filter: blur(20px) saturate(180%);
            border: 2px solid #FFD700;
            border-left: 4px solid #FFD700;
            border-top: 3px solid rgba(255, 235, 150, 0.8);
            box-shadow: 
                0 4px 20px rgba(255, 215, 0, 0.5),
                inset 0 2px 0 rgba(255, 235, 150, 0.6),
                inset 0 -2px 0 rgba(184, 134, 11, 0.8),
                0 0 30px rgba(255, 215, 0, 0.3);
        }
        
        /* Metallic gold shine effect */
        .widget.goodcounsel::before {
            background: linear-gradient(to bottom, rgba(255, 235, 150, 0.4), transparent 40%, transparent 60%, rgba(184, 134, 11, 0.3));
        }

        /* Gold wafer reflection sweep */
        .widget.goodcounsel::after {
            background: linear-gradient(90deg, transparent, rgba(255, 235, 150, 0.6), transparent);
        }
        
        .widget.goodcounsel .widget-header {
            background: linear-gradient(to bottom, rgba(255, 235, 150, 0.3), transparent);
            border-bottom: 1px solid rgba(255, 215, 0, 0.5);
        }
        
        .widget.goodcounsel .widget-title {
            color: #FFF4D4;
            text-shadow: 
                0 1px 2px rgba(0, 0, 0, 0.8),
                0 0 15px rgba(255, 215, 0, 0.8),
                0 -1px 0 rgba(255, 235, 150, 0.5);
            font-weight: 700;
            letter-spacing: 0.08em;
        }

        .widget.goodcounsel .widget-indicator {
            background: var(--gold);
        }

        .widget.goodcounsel .insight-card.positive {
            border-left-color: var(--cyber-green);
        }

        /* Performance Widget - Blue - more visible tint */
        .widget.performance {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.28) 0%, rgba(59, 130, 246, 0.15) 100%);
            border-left: 4px solid var(--glass-blue);
            border-top: 1px solid rgba(59, 130, 246, 0.4);
        }

        .widget.performance::before {
            background: linear-gradient(90deg, transparent, var(--glass-blue), transparent);
        }

        /* Focus Widget - Purple - more visible tint */
        .widget.focus {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.28) 0%, rgba(168, 85, 247, 0.15) 100%);
            border-left: 4px solid var(--electric-purple);
            border-top: 1px solid rgba(168, 85, 247, 0.4);
        }

        .widget.focus::before {
            background: linear-gradient(90deg, transparent, var(--electric-purple), transparent);
        }

        .widget::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            opacity: 0.5;
        }

        .widget:hover::before {
            opacity: 1;
        }

        .widget-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 0.5rem;
        }

        .widget-indicator {
            width: 4px;
            height: 2rem;
            border-radius: 0;
        }

        .widget-title {
            font-size: 1rem; /* slightly smaller */
            font-weight: 500;
            letter-spacing: 0.5px;
            margin: 0; /* compact */
        }

        .widget-content {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
        }

        .stat-label {
            color: var(--steel-gray);
        }

        .stat-value {
            font-weight: 600;
            font-family: 'Courier New', monospace;
        }

        .insight-card {
            background: rgba(0, 0, 0, 0.3);
            padding: 0.25rem;
            border-radius: 0;
            border-left: 4px solid;
        }

        .insight-card.positive { border-left-color: var(--cyber-green); }
        .insight-card.warning { border-left-color: var(--neon-orange); }
        .insight-card.critical { border-left-color: #ef4444; }
        .insight-card.info { border-left-color: var(--glass-blue); }

        .insight-text {
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }

        .insight-subtext {
            font-size: 0.75rem;
            color: var(--steel-gray);
        }

        /* Gold text for GoodCounsel */
        .widget.goodcounsel .insight-subtext.gold {
            color: var(--gold);
        }

        /* Workflow Area */
        .workflow-area {
            margin-top: 0.25rem;
            position: relative;
            background: linear-gradient(135deg, rgba(30, 58, 95, 0.3) 0%, rgba(15, 20, 25, 0.4) 100%);
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            padding: 0.5rem;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .workflow-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid rgba(59, 130, 246, 0.3);
        }

        .workflow-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--white);
            margin: 0;
            text-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }

        /* Mechanical Track System - Corten Steel */
        .workflow-pipeline::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, rgba(96,125,139,0.6), rgba(59,130,246,0.35));
            box-shadow: 0 1px 2px rgba(0,0,0,0.25);
            z-index: 50;
        }

        /* Track Rails - Upper and Lower */
        .workflow-pipeline::after { content: none; }

        /* Additional rail below track */
        .workflow-pipeline {
            position: relative;
        }

        .workflow-pipeline .track-rail-bottom { display: none; }

        /* Track Support Brackets */
        .workflow-pipeline .track-brackets { display: none; }

        /* Multi-tier Support */
        .workflow-pipeline.multi-tier {
            display: grid;
            grid-template-rows: 1fr auto 1fr;
            gap: 2rem;
        }

        .workflow-tier {
            display: flex;
            gap: 1rem;
            align-items: stretch;
            position: relative;
            padding: 1rem 0;
        }

        .workflow-tier:nth-child(odd) {
            flex-direction: row;
        }

        .workflow-tier:nth-child(even) {
            flex-direction: row-reverse;
        }

        /* Tier Connector (Snake) - Mechanical */
        .tier-connector {
            position: absolute;
            right: 0;
            top: 20px;
            width: 60px;
            height: 40px;
            z-index: 2;
        }

        .tier-connector::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 30px;
            height: 4px;
            background: linear-gradient(90deg, #8B4513 0%, #A0522D 50%, #8B4513 100%);
            border-radius: 2px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .tier-connector::after {
            content: '';
            position: absolute;
            top: 0;
            right: 30px;
            width: 4px;
            height: 40px;
            background: linear-gradient(180deg, #8B4513 0%, #A0522D 50%, #8B4513 100%);
            border-radius: 2px;
            box-shadow: 1px 0 2px rgba(0, 0, 0, 0.5);
        }

        /* Snake connector for multi-tier */
        .snake-connector {
            position: absolute;
            right: 0;
            top: 20px;
            width: 80px;
            height: 60px;
            z-index: 2;
        }

        .snake-connector::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 40px;
            height: 4px;
            background: linear-gradient(90deg, #8B4513 0%, #A0522D 50%, #8B4513 100%);
            border-radius: 2px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .snake-connector::after {
            content: '';
            position: absolute;
            top: 0;
            right: 40px;
            width: 4px;
            height: 60px;
            background: linear-gradient(180deg, #8B4513 0%, #A0522D 50%, #8B4513 100%);
            border-radius: 2px;
            box-shadow: 1px 0 2px rgba(0, 0, 0, 0.5);
        }

        .snake-connector .snake-turn {
            position: absolute;
            top: 56px;
            right: 40px;
            width: 40px;
            height: 4px;
            background: linear-gradient(90deg, #8B4513 0%, #A0522D 50%, #8B4513 100%);
            border-radius: 2px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .workflow-pipeline {
                flex-direction: column;
                gap: 1.5rem;
            }
            
            .workflow-stage {
                flex: 1 1 auto;
            }

            .connector-line,
            .connector-arrow {
                display: none;
            }
        }

        /* Drag feedback */
        .drag-over {
            background: var(--accent-glow);
            border-color: var(--glass-blue);
        }

        /* Expanded panel overlay */
        .panel-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 26, 42, 0.95);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            z-index: 1000;
            display: none;
            padding: 2rem;
            overflow-y: auto;
        }

        .panel-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .expanded-panel {
            background: linear-gradient(135deg, var(--panel-glass) 0%, rgba(255, 255, 255, 0.04) 100%);
            -webkit-backdrop-filter: blur(15px) saturate(120%);
            backdrop-filter: blur(15px) saturate(120%);
            border: 1px solid var(--panel-border);
            border-radius: 0;
            padding: 3rem;
            max-width: 1200px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--panel-border);
            border-radius: 0;
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            color: var(--chrome);
            font-size: 1rem;
        }

        .close-btn:hover {
            background: var(--accent-glow);
        }

        /* Help Chat Modal */
        .help-chat-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .help-chat-modal {
            background: linear-gradient(135deg, rgba(30, 58, 95, 0.95) 0%, rgba(10, 26, 42, 0.95) 100%);
            border: 1px solid var(--panel-border);
            border-radius: 8px;
            width: 600px;
            height: 500px;
            display: flex;
            flex-direction: column;
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }

        .help-chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid var(--panel-border);
        }

        .help-chat-header h3 {
            color: var(--white);
            margin: 0;
        }

        .ai-provider-selector {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .ai-provider-selector label {
            color: var(--chrome);
            font-size: 0.9rem;
        }

        .ai-provider-selector select {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--panel-border);
            color: var(--white);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
        }

        .help-chat-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 1rem;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 1rem;
        }

        .chat-message {
            margin-bottom: 1rem;
            display: flex;
        }

        .chat-message.bot {
            justify-content: flex-start;
        }

        .chat-message.user {
            justify-content: flex-end;
        }

        .message-content {
            background: rgba(0, 0, 0, 0.3);
            padding: 0.75rem 1rem;
            border-radius: 8px;
            max-width: 80%;
            color: var(--white);
            border: 1px solid var(--panel-border);
        }

        .chat-message.user .message-content {
            background: var(--accent-glow);
            border-color: var(--glass-blue);
        }

        .chat-input-area {
            display: flex;
            gap: 0.5rem;
        }

        .chat-input-area input {
            flex: 1;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--panel-border);
            color: var(--white);
            padding: 0.75rem;
            border-radius: 4px;
        }

        .send-btn {
            background: var(--cyber-green);
            border: 1px solid var(--cyber-green);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
        }

        .send-btn:hover {
            background: #059669;
        }

        /* Beta Report Widget - Caution Border */
        .beta-report {
            border: 4px solid #FF8C00 !important;
            border-image: repeating-linear-gradient(45deg, #FFD700, #FFD700 10px, #000000 10px, #000000 20px) 4 !important;
            box-shadow: 0 0 20px rgba(255, 140, 0, 0.6) !important;
            max-height: 180px;
            overflow: hidden;
            position: relative;
        }

        .widget.beta-report { 
            padding: 0.5rem; 
-            background: 
-                linear-gradient(135deg, rgba(226, 232, 240, 0.25) 0%, rgba(148, 163, 184, 0.2) 100%),
-                #0f1419;
-            border: 1px solid rgba(255, 255, 255, 0.35);
+            background: 
+                linear-gradient(135deg, rgba(226, 232, 240, 0.4) 0%, rgba(203, 213, 225, 0.35) 100%),
+                #0f1419;
+            border: 1px solid rgba(255, 255, 255, 0.45);
         }
         .widget.beta-report .widget-content { gap: 0.5rem; }
         .widget.beta-report .beta-badge { display: none; }
         .widget.beta-report::before { content: none !important; display: none !important; }
         .beta-select {
             background: rgba(0, 0, 0, 0.3);
             border: 1px solid var(--panel-border);
             color: var(--white);
             padding: 0.5rem;
             border-radius: 4px;
             width: 100%;
         }

         .beta-options {
             display: flex;
             flex-direction: column;
             gap: 0.5rem;
         }

         .beta-option {
             background: rgba(0, 0, 0, 0.3);
             border: 1px solid var(--panel-border);
             color: var(--white);
             padding: 0.75rem;
             border-radius: 4px;
             cursor: pointer;
             transition: all 0.2s ease;
             font-size: 0.85rem;
             text-align: left;
         }

         .beta-option:hover {
             background: var(--accent-glow);
             border-color: var(--glass-blue);
         }

         /* Report Modal */
         .report-modal-overlay {
             position: fixed;
             top: 0;
             left: 0;
             right: 0;
             bottom: 0;
             background: rgba(0, 0, 0, 0.8);
             z-index: 2000;
             display: none;
             align-items: center;
             justify-content: center;
         }

         .report-modal {
             background: linear-gradient(135deg, rgba(30, 58, 95, 0.95) 0%, rgba(10, 26, 42, 0.95) 100%);
             border: 1px solid var(--panel-border);
             border-radius: 8px;
             width: 500px;
             padding: 2rem;
             -webkit-backdrop-filter: blur(20px);
             backdrop-filter: blur(20px);
             box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
         }

         .report-modal h3 {
             color: var(--white);
             margin-bottom: 1rem;
         }

         .report-form {
             display: flex;
             flex-direction: column;
             gap: 1rem;
         }

         .report-form label {
             color: var(--chrome);
             font-weight: 500;
         }

         .report-form input,
         .report-form textarea,
         .report-form select {
             background: rgba(0, 0, 0, 0.3);
             border: 1px solid var(--panel-border);
             color: var(--white);
             padding: 0.75rem;
             border-radius: 4px;
         }

         .report-form textarea {
             height: 100px;
             resize: vertical;
         }

         .report-buttons {
             display: flex;
             gap: 1rem;
             justify-content: flex-end;
             margin-top: 1rem;
         }

         .report-buttons button {
             padding: 0.75rem 1.5rem;
             border-radius: 4px;
             cursor: pointer;
             border: none;
         }

         .submit-btn {
             background: var(--cyber-green);
             color: white;
         }

         .cancel-btn {
             background: rgba(0, 0, 0, 0.3);
             color: var(--white);
             border: 1px solid var(--panel-border);
         }

         /* Widgets Grid - Compressed for space */
         .widgets-grid {
             display: grid;
             grid-template-columns: repeat(5, 1fr);
             gap: 0.75rem;
             margin-bottom: 0.75rem;
         }

         /* Browser Compatibility */
         .browser-warning {
             position: fixed;
             top: 0;
             left: 0;
             right: 0;
             background: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%);
             color: white;
             padding: 1rem;
             text-align: center;
             z-index: 10000;
             display: none;
             box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
         }

         .browser-warning.show {
             display: block;
         }

         .browser-warning-content {
             max-width: 1200px;
             margin: 0 auto;
             display: flex;
             align-items: center;
             justify-content: center;
             gap: 1rem;
         }

         .browser-warning-text {
             flex: 1;
             font-size: 0.9rem;
             line-height: 1.4;
         }

         .browser-warning-close {
             background: rgba(255, 255, 255, 0.2);
             border: 1px solid rgba(255, 255, 255, 0.3);
             color: white;
             padding: 0.5rem 1rem;
             border-radius: 4px;
             cursor: pointer;
             font-size: 0.8rem;
         }

         .browser-warning-close:hover {
             background: rgba(255, 255, 255, 0.3);
         }

         /* Chrome Advisory */
         .chrome-advisory {
             position: fixed;
             top: 0;
             left: 0;
             right: 0;
             background: linear-gradient(135deg, #FFA500 0%, #FF8C00 100%);
             color: white;
             padding: 1rem;
             text-align: center;
             z-index: 10001;
             display: none;
             box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
         }

         .chrome-advisory.show {
             display: block;
         }

         .chrome-advisory-content {
             max-width: 1200px;
             margin: 0 auto;
             display: flex;
             align-items: center;
             justify-content: center;
             gap: 1rem;
         }

         .chrome-advisory-text {
             flex: 1;
             font-size: 0.9rem;
             line-height: 1.4;
         }

         .chrome-advisory-close {
             background: rgba(255, 255, 255, 0.2);
             border: 1px solid rgba(255, 255, 255, 0.3);
             color: white;
             padding: 0.5rem 1rem;
             border-radius: 4px;
             cursor: pointer;
             font-size: 0.8rem;
         }

         .chrome-advisory-close:hover {
             background: rgba(255, 255, 255, 0.3);
         }

         .chrome-advisory-snooze {
             background: rgba(255, 255, 255, 0.1);
             border: 1px solid rgba(255, 255, 255, 0.3);
             color: white;
             padding: 0.5rem 1rem;
             border-radius: 4px;
             cursor: pointer;
             font-size: 0.8rem;
             margin-left: 0.5rem;
         }

         .chrome-advisory-snooze:hover {
             background: rgba(255, 255, 255, 0.2);
         }

         /* AI Error Reporting Footer */
         .ai-error-footer {
             position: fixed;
             bottom: 0;
             left: 0;
             right: 0;
             background: rgba(30, 58, 95, 0.95);
             color: #60A5FA;
             padding: 0.5rem;
             font-size: 0.75rem;
             text-align: center;
             z-index: 1000;
             border-top: 1px solid rgba(59, 130, 246, 0.3);
         }

         .ai-error-footer a {
             color: #60A5FA;
             text-decoration: none;
             margin: 0 0.5rem;
         }

         .ai-error-footer a:hover {
             text-decoration: underline;
         }


         /* Browser-specific CSS fixes */
         @supports (-webkit-appearance: none) {
             /* Safari specific fixes */
             .workflow-stage {
                 -webkit-backdrop-filter: blur(60px) saturate(180%) brightness(1.2) contrast(1.1);
                 backdrop-filter: blur(60px) saturate(180%) brightness(1.2) contrast(1.1);
             }
         }

         @-moz-document url-prefix() {
             /* Firefox specific fixes */
             .workflow-stage {
                 backdrop-filter: blur(40px) saturate(150%) brightness(1.1) contrast(1.05);
             }
         }

         @media screen and (-ms-high-contrast: active), (-ms-high-contrast: none) {
             /* Edge specific fixes */
             .workflow-stage {
                 background: rgba(30, 58, 95, 0.8);
                 backdrop-filter: none;
             }
         }

         .widget.beta-report .beta-badge { display: none; }
         .widget.beta-report::before { content: none !important; display: none !important; }

         /* Ensure GoodCounsel matches Today's Focus width (first wide column) */
         .widgets-grid .widget.focus { grid-column: 1 / span 2 !important; grid-row: 1; }
         .widgets-grid .widget.goodcounsel { grid-column: 3 / span 2 !important; grid-row: 1; }
         .widgets-grid .widget.beta-report { grid-column: 5 !important; grid-row: 1; }
         .beta-checklist {
             background: rgba(255, 255, 255, 0.06);
             border: 1px solid rgba(255, 255, 255, 0.25);
             border-radius: 4px;
             padding: 0.5rem;
             max-height: 7.5rem; /* ~4 items visible */
             overflow-y: auto;
+            font-family: 'Roboto Condensed', 'Inter', 'SF Pro Text', 'Helvetica Neue', Arial, sans-serif;
+            font-weight: 300;
+            font-size: 0.8rem;
+            line-height: 1.2;
         }
-        .beta-checklist .beta-item { display: flex; align-items: center; gap: 0.5rem; padding: 0.25rem 0; }
+        .beta-checklist .beta-item { display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.25rem 0; width: 100%; white-space: nowrap; }
         .beta-checklist input[type="radio"] { accent-color: var(--glass-blue); }
         .beta-go-btn {
             margin-top: 0.5rem;
             background: var(--glass-blue);
             border: 1px solid var(--glass-blue);
             color: white;
             padding: 0.5rem 0.75rem;
             border-radius: 4px;
             cursor: pointer;
         }
         .beta-go-btn:hover { filter: brightness(1.1); }

        .ui-icon { width: 20px; height: 20px; display: inline-block; vertical-align: middle; color: #cbd5e1; }
        .status-pill .ui-icon { margin-right: 0.3rem; }
        .widget .ui-icon { margin-right: 0.5rem; }
        .stage-icon .ui-icon { width: 22px; height: 22px; }
+        /* Urgency colors for alert icon inside ticker */
+        .ticker-item.critical .alert-icon { color: #DC2626; }
+        .ticker-item.high .alert-icon { color: #F59E0B; }
+        .ticker-item.medium .alert-icon { color: #3B82F6; }
+        .ticker-item.low .alert-icon { color: #10B981; }
+        /* GoodCounsel title icon color */
+        .widget.goodcounsel .widget-title .ui-icon { color: #10B981; }
+        <!-- Simple open book outline -->
+        <symbol id="icon-book-open" viewBox="0 0 24 24">
+            <path d="M4 7h7a2 2 0 0 1 2 2v9H6a2 2 0 0 1-2-2V7z" fill="none" stroke="currentColor" stroke-width="2.25"/>
+            <path d="M20 7h-7a2 2 0 0 0-2 2v9h7a2 2 0 0 0 2-2V7z" fill="none" stroke="currentColor" stroke-width="2.25"/>
+        </symbol>
+        <!-- Crossed swords (response filed/needed) single-color line -->
+        <symbol id="icon-swords" viewBox="0 0 24 24">
+            <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2.25" stroke-linecap="round"/>
+            <path d="M5 6h3l-1.5 1.5L5 6zM16 15l3 3-1.5 1.5-3-3L16 15z" fill="currentColor"/>
+        </symbol>
+        <!-- Flag with exclamation (red flag) single-color line -->
+        <symbol id="icon-flag-alert" viewBox="0 0 24 24">
+            <path d="M5 4v16" stroke="currentColor" stroke-width="2.25"/>
+            <path d="M6 5h11l-3 4h-8" fill="none" stroke="currentColor" stroke-width="2.25" stroke-linejoin="round"/>
+            <path d="M13 7v3" stroke="currentColor" stroke-width="2"/>
+            <circle cx="13" cy="11.5" r="1" fill="currentColor"/>
+        </symbol>
+        /* Enforce square corners across UI (preserve circular avatars/logos) */
+        .status-pill,
+        .widget,
+        .priority-ticker,
+        .widget-menu,
+        .current-widget-item,
+        .widget-option,
+        .workflow-area,
+        .help-chat-modal,
+        .report-modal,
+        .tracking-card,
+        .expanded-panel,
+        .panel-overlay,
+        .action-btn,
+        .control-btn,
+        .browser-warning,
+        .chrome-advisory,
+        .beta-checklist,
+        .ai-error-footer {
+            border-radius: 0 !important;
+        }
     </style>
    <!-- UI Icon Sprite -->
    <svg xmlns="http://www.w3.org/2000/svg" style="display:none">
        <symbol id="icon-mail" viewBox="0 0 24 24">
            <rect x="3" y="6" width="18" height="12" rx="2" fill="none" stroke="currentColor" stroke-width="2.25"/>
            <path d="M4 7l8 6 8-6" fill="none" stroke="currentColor" stroke-width="2.25" stroke-linecap="round" stroke-linejoin="round"/>
        </symbol>
        <symbol id="icon-ai" viewBox="0 0 24 24">
            <rect x="7" y="3" width="10" height="18" rx="2.5" fill="none" stroke="currentColor" stroke-width="2"/>
            <circle cx="12" cy="12" r="4" fill="none" stroke="currentColor" stroke-width="2"/>
            <circle cx="12" cy="12" r="1.6" fill="currentColor"/>
        </symbol>
        <symbol id="icon-clio" viewBox="0 0 24 24">
            <!-- briefcase: outline + handle + latch -->
            <rect x="4" y="8" width="16" height="10" rx="2" fill="none" stroke="currentColor" stroke-width="2.25"/>
            <path d="M9 8v-1.5a1.5 1.5 0 0 1 1.5-1.5h3a1.5 1.5 0 0 1 1.5 1.5V8" fill="none" stroke="currentColor" stroke-width="2.25"/>
            <rect x="11" y="12" width="2" height="2" rx="1" fill="currentColor"/>
        </symbol>
        <symbol id="icon-calendar" viewBox="0 0 24 24">
            <rect x="4" y="6" width="16" height="14" rx="2" fill="none" stroke="currentColor" stroke-width="2.25"/>
            <path d="M8 4v4M16 4v4M4 10h16" stroke="currentColor" stroke-width="2.25"/>
            <path d="M10 16h4M11 14h3" stroke="currentColor" stroke-width="2"/>
        </symbol>
        <symbol id="icon-research" viewBox="0 0 24 24">
+            <defs>
+                <!-- Left page mask: punch multiple wavy-ish lines and a tiny corner curl -->
+                <mask id="research-left-mask">
+                    <rect x="0" y="0" width="24" height="24" fill="#fff"/>
+                    <!-- six horizontal cut lines (slightly varying lengths) -->
+                    <rect x="5.2" y="8.3" width="6.2" height="1.1" rx="0.55" fill="#000"/>
+                    <rect x="5.2" y="9.9" width="6.0" height="1.1" rx="0.55" fill="#000"/>
+                    <rect x="5.2" y="11.5" width="5.8" height="1.1" rx="0.55" fill="#000"/>
+                    <rect x="5.2" y="13.1" width="5.6" height="1.1" rx="0.55" fill="#000"/>
+                    <rect x="5.2" y="14.7" width="5.4" height="1.1" rx="0.55" fill="#000"/>
+                    <rect x="5.2" y="16.3" width="5.2" height="1.1" rx="0.55" fill="#000"/>
+                    <!-- small inner-bottom curl notch -->
+                    <circle cx="11.8" cy="17.9" r="0.8" fill="#000"/>
+                </mask>
+                <!-- Right page mask: three lines and dog-eared top-right corner -->
+                <mask id="research-right-mask">
+                    <rect x="0" y="0" width="24" height="24" fill="#fff"/>
+                    <rect x="14.3" y="9.0" width="5.6" height="1.2" rx="0.6" fill="#000"/>
+                    <rect x="14.3" y="11.1" width="5.0" height="1.2" rx="0.6" fill="#000"/>
+                    <rect x="14.3" y="13.2" width="4.2" height="1.2" rx="0.6" fill="#000"/>
+                    <!-- dog ear -->
+                    <path d="M20 6 L20 8 L18 6 Z" fill="#000"/>
+                </mask>
+            </defs>
+            <!-- Left page block -->
+            <path d="M4 6h7.6c1.7 0 3.0 1.2 3.5 2.8h-3.9c-2.1 0-3.8 1.7-3.8 3.8V18H6.3A2.3 2.3 0 0 1 4 15.7V6z" fill="currentColor" mask="url(#research-left-mask)"/>
+            <!-- Right page block -->
+            <path d="M12 6h8v9.9h-5.9c-1.6 0-3-1.3-3-3V6z" fill="currentColor" mask="url(#research-right-mask)"/>
+            <!-- Magnifier ring (bold) -->
+            <circle cx="17.4" cy="14.6" r="3.2" fill="none" stroke="currentColor" stroke-width="2.8"/>
+            <!-- Hairline overlay to keep ring readable over overlaps -->
+            <circle cx="17.4" cy="14.6" r="3.2" fill="none" stroke="currentColor" stroke-width="1" vector-effect="non-scaling-stroke"/>
+            <!-- Handle -->
+            <path d="M19.3 16.5l3.1 3.1" stroke="currentColor" stroke-width="2.8" stroke-linecap="round"/>
         </symbol>
        <symbol id="icon-priority" viewBox="0 0 24 24">
            <path d="M12 2l10 18H2L12 2z" fill="none" stroke="currentColor" stroke-width="2.5"/>
            <rect x="11.15" y="7.6" width="1.7" height="6.8" fill="currentColor"/>
            <circle cx="12" cy="16.8" r="1.4" fill="currentColor"/>
        </symbol>
        <symbol id="icon-focus" viewBox="0 0 24 24">
            <path d="M2 12c2.8-4 7-6 10-6s7.2 2 10 6c-2.8 4-7 6-10 6s-7.2-2-10-6z" fill="none" stroke="currentColor" stroke-width="2.25"/>
            <circle cx="12" cy="12" r="3" fill="none" stroke="currentColor" stroke-width="2.25"/>
        </symbol>
        <symbol id="icon-goodcounsel" viewBox="0 0 24 24">
            <!-- heart outline + clear leaf stroke -->
            <path d="M12 20s-6-4.2-6-8.2c0-2.2 1.8-4 4-4 1.2 0 2.3 0.6 3 1.5 0.7-0.9 1.8-1.5 3-1.5 2.2 0 4 1.8 4 4 0 4-6 8.2-6 8.2z" fill="none" stroke="currentColor" stroke-width="2.25"/>
            <path d="M14 10.2c1.9 0.7 3.7 2.1 4.2 3.9M15.2 11.6c1 0.4 1.8 1.1 2.3 2" stroke="currentColor" stroke-width="1.8" fill="none"/>
        </symbol>
        <symbol id="icon-performance" viewBox="0 0 24 24">
            <rect x="4" y="4" width="16" height="16" rx="3" fill="none" stroke="currentColor" stroke-width="2.25"/>
            <path d="M7 15l3-3 3 2 4-5" stroke="currentColor" stroke-width="2.25" fill="none"/>
            <circle cx="7" cy="15" r="1.2" fill="currentColor"/>
            <circle cx="10" cy="12" r="1.2" fill="currentColor"/>
            <circle cx="13" cy="14" r="1.2" fill="currentColor"/>
            <circle cx="17" cy="9" r="1.2" fill="currentColor"/>
        </symbol>
        <symbol id="icon-testing" viewBox="0 0 24 24">
            <!-- circle with negative-space beta via mask -->
            <defs>
                <mask id="m-beta-mask">
                    <rect x="0" y="0" width="24" height="24" fill="#fff"/>
                    <text x="12" y="16" text-anchor="middle" font-size="12" fill="#000" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif"></text>
                </mask>
            </defs>
            <circle cx="12" cy="12" r="9" fill="currentColor" mask="url(#m-beta-mask)"/>
            <circle cx="12" cy="12" r="9" fill="none" stroke="currentColor" stroke-width="2" opacity="0.6"/>
        </symbol>
        <!-- Alerts -->
        <symbol id="icon-critical" viewBox="0 0 24 24">
            <path d="M12 2l10 18H2L12 2z" fill="#DC2626"/>
            <rect x="11" y="9" width="2" height="6" fill="#fff"/>
            <circle cx="12" cy="17" r="1.3" fill="#fff"/>
        </symbol>
        <symbol id="icon-high" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="10" fill="#F59E0B"/>
            <rect x="11" y="7" width="2" height="7" fill="#fff"/>
            <circle cx="12" cy="16.5" r="1.2" fill="#fff"/>
        </symbol>
        <symbol id="icon-medium" viewBox="0 0 24 24">
            <rect x="4" y="4" width="16" height="16" rx="3" fill="#60A5FA"/>
            <rect x="7" y="7" width="10" height="10" rx="2" fill="#fff" opacity="0.25"/>
        </symbol>
        <symbol id="icon-low" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="10" stroke="#93C5FD" stroke-width="2" fill="none"/>
            <circle cx="12" cy="12" r="3" fill="#93C5FD"/>
        </symbol>
        <!-- Workflow stages -->
        <symbol id="icon-intake" viewBox="0 0 24 24">
            <!-- stack of documents + incoming arrow -->
            <path d="M6 7h7a2 2 0 0 1 2 2v8H8a2 2 0 0 1-2-2V7z" fill="none" stroke="currentColor" stroke-width="2.25"/>
            <path d="M8 5h7a2 2 0 0 1 2 2v8" fill="none" stroke="currentColor" stroke-width="2.25" opacity="0.6"/>
            <path d="M4 12h7" stroke="currentColor" stroke-width="2.25"/>
            <path d="M10.5 12l-2.5 -2M10.5 12l-2.5 2" stroke="currentColor" stroke-width="2.25"/>
        </symbol>
        <symbol id="icon-analysis" viewBox="0 0 24 24">
            <!-- clearer microscope silhouette as outline-only -->
            <path d="M6 19h12" stroke="currentColor" stroke-width="2.5"/>
            <path d="M9 13h6" stroke="currentColor" stroke-width="2.25"/>
            <path d="M10.5 16c0-3 2.2-5 5-5" stroke="currentColor" stroke-width="2.25" fill="none" stroke-linecap="round"/>
            <path d="M14.5 6v6M15 4h3" stroke="currentColor" stroke-width="2.25" stroke-linecap="round"/>
            <circle cx="11" cy="13" r="1" fill="currentColor"/>
        </symbol>
        <symbol id="icon-draft" viewBox="0 0 24 24">
            <!-- paper outline -->
            <rect x="5" y="4.5" width="10.5" height="15" rx="1.8" fill="none" stroke="currentColor" stroke-width="2.25"/>
            <path d="M7.2 9h6.6M7.2 12h5.5M7.2 15h4.2" stroke="currentColor" stroke-width="2"/>
            <!-- pen strokes -->
            <path d="M15.6 13.2l4.2 4.2" stroke="currentColor" stroke-width="2.25"/>
            <path d="M17 16l-1.6 1.6" stroke="currentColor" stroke-width="2.25"/>
        </symbol>
        <symbol id="icon-attorney" viewBox="0 0 24 24">
            <!-- checklist -->
            <rect x="6" y="5" width="12" height="14" rx="2.5" fill="currentColor"/>
            <path d="M9 9l2 2 4-4" stroke="#60A5FA" stroke-width="2.25" fill="none"/>
            <path d="M9 13h6M9 16h6" stroke="#60A5FA" stroke-width="2.25"/>
        </symbol>
        <symbol id="icon-final-review" viewBox="0 0 24 24">
            <!-- ribbon/medal seal -->
            <circle cx="12" cy="10" r="6" fill="none" stroke="currentColor" stroke-width="2.25"/>
            <path d="M9 10l2 2 3-3" stroke="currentColor" stroke-width="2.25" fill="none"/>
            <path d="M10 16l-2 4 4-2 4 2-2-4" fill="currentColor"/>
        </symbol>
        <symbol id="icon-file-serve" viewBox="0 0 24 24">
            <path d="M6 12h8" stroke="currentColor" stroke-width="2.25"/>
            <path d="M14 12l4 -2M14 12l4 0M14 12l4 2" stroke="currentColor" stroke-width="2.25"/>
        </symbol>
        <symbol id="icon-client-update" viewBox="0 0 24 24">
            <path d="M7 5h6v4H7z" fill="currentColor"/>
            <path d="M9 9l5 5" stroke="#60A5FA" stroke-width="2.25"/>
            <path d="M13 14l4 4" stroke="#60A5FA" stroke-width="2.25"/>
        </symbol>
        <symbol id="icon-progress-summary" viewBox="0 0 24 24">
            <rect x="4" y="10" width="16" height="4" rx="2.2" fill="none" stroke="currentColor" stroke-width="2.25"/>
            <path d="M4 12h12.5" stroke="currentColor" stroke-width="2.25"/>
        </symbol>
        <symbol id="icon-shield" viewBox="0 0 24 24">
            <path d="M12 3l8 3v6c0 5-3.5 7.5-8 9-4.5-1.5-8-4-8-9V6l8-3z" fill="none" stroke="currentColor" stroke-width="2.25"/>
            <!-- scales inside -->
            <path d="M12 8v6" stroke="currentColor" stroke-width="2"/>
            <path d="M8 10h8" stroke="currentColor" stroke-width="2"/>
            <path d="M9 10l-2 3h4l-2-3zM17 10l-2 3h4l-2-3z" fill="none" stroke="currentColor" stroke-width="1.8"/>
        </symbol>
        <symbol id="icon-beta" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="9" fill="currentColor" opacity="0.2"/>
            <text x="12" y="16" text-anchor="middle" font-size="12" fill="#60A5FA"></text>
        </symbol>
        <!-- Generic alert triangle icon for ticker items -->
        <symbol id="icon-alert" viewBox="0 0 24 24">
            <path d="M12 3l10 18H2L12 3z" fill="none" stroke="currentColor" stroke-width="2.25" stroke-linejoin="round"/>
            <path d="M12 9v6" stroke="currentColor" stroke-width="2.25" stroke-linecap="round"/>
            <circle cx="12" cy="17" r="1.2" fill="currentColor"/>
        </symbol>
        <!-- Beta in hollow circle for Testing -->
        <symbol id="icon-beta-circle" viewBox="0 0 24 24">
            <defs><mask id="mask-beta"><rect width="24" height="24" fill="#fff"/>
                <text x="12" y="16" text-anchor="middle" font-size="12" font-family="-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial" fill="#000"></text>
            </mask></defs>
            <circle cx="12" cy="12" r="9" fill="none" stroke="currentColor" stroke-width="2"/>
            <circle cx="12" cy="12" r="9" fill="currentColor" mask="url(#mask-beta)"/>
        </symbol>
        <!-- Lightbulb outline for GoodCounsel insights -->
        <symbol id="icon-lightbulb" viewBox="0 0 24 24">
            <path d="M12 3a6 6 0 0 1 6 6c0 2-1 3.5-2.4 4.6-.5.4-.8 1-.8 1.6V17H9.2v-1.8c0-.6-.3-1.2-.8-1.6A6 6 0 0 1 6 9a6 6 0 0 1 6-6z" fill="none" stroke="currentColor" stroke-width="2"/>
            <path d="M9.5 19h5M10 21h4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </symbol>
        <!-- Simple open book outline -->
        <symbol id="icon-book-open" viewBox="0 0 24 24">
            <path d="M4 7h7a2 2 0 0 1 2 2v9H6a2 2 0 0 1-2-2V7z" fill="none" stroke="currentColor" stroke-width="2.25"/>
            <path d="M20 7h-7a2 2 0 0 0-2 2v9h7a2 2 0 0 0 2-2V7z" fill="none" stroke="currentColor" stroke-width="2.25"/>
        </symbol>
    </svg>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo-container">
                    <img src="attached_assets/LexFiatLogo_HeaderBlue.png" alt="LexFiat Logo" class="logo-image">
                </div>
                <div class="logo-text-container">
                    <div class="logo-text">LexFiat</div>
                    <div id="rotating-slogan">The Power of Clarity</div>
                </div>
            </div>
            
            <div class="header-right">
                <div class="status-pills">
                    <div class="status-pill" onclick="expandPanel('gmail')" title="Click to view inbox">
                        <div class="status-dot success"></div>
                        <svg class="ui-icon"><use href="#icon-mail"/></svg><span>Gmail</span>
                    </div>
                    <div class="status-pill" onclick="expandPanel('ai-status')" title="Click to view AI provider status">
                        <div class="status-dot processing"></div>
                        <svg class="ui-icon"><use href="#icon-ai"/></svg><span>AI</span>
                    </div>
                    <div class="status-pill" id="clio-status-pill" onclick="expandPanel('clio')" title="Click to view Clio integration">
                        <div class="status-dot warning" id="clio-status-dot"></div>
                        <svg class="ui-icon"><use href="#icon-clio"/></svg><span>Clio</span>
                    </div>
                    <div class="status-pill" onclick="expandPanel('calendar')" title="Click to view calendar">
                        <div class="status-dot success"></div>
                        <svg class="ui-icon"><use href="#icon-calendar"/></svg><span>Calendar</span>
                    </div>
                    <div class="status-pill" onclick="expandPanel('research')" title="Click to open legal research">
                        <div class="status-dot warning"></div>
                        <svg class="ui-icon"><use href="#icon-research-book"/></svg><span>Research</span>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="action-btn" onclick="openHelpChat()"> Help</button>
                    <button class="action-btn admin" onclick="expandPanel('admin')"> Admin</button>
                    <button class="action-btn" onclick="expandPanel('settings')">Settings</button>
                </div>

                <div class="avatar-section">
                    <div class="avatar" onclick="expandPanel('profile')" title="Click to edit profile">
                        <img src="attached_assets/IMG_0104_1754179760418.JPG" alt="Mekel S. Miller">
                    </div>
                    <div class="attorney-info">
                        <div class="attorney-name">Mekel S. Miller</div>
                        <div class="attorney-title">Family Law</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Page Header - Removed for space -->

        <!-- Priority Status Ticker Widget -->
        <div class="widget priority-ticker" id="priority-ticker-widget">
            <div class="widget-header">
                <div class="widget-indicator" style="background: #ef4444;"></div>
                <h3 class="widget-title"><svg class="ui-icon"><use href="#icon-priority"/></svg>Priority Alerts</h3>
                <div class="widget-controls">
                    <button class="widget-toggle" onclick="toggleWidget('priority-ticker')" title="Toggle widget"></button>
                    <button class="widget-resize" onclick="resizeWidget('priority-ticker')" title="Resize widget"></button>
                </div>
            </div>
            <div class="widget-content">
                <div class="ticker-content" id="ticker-content">
                    <div class="ticker-item critical active" onclick="openTrackingCard('emergency-motion-001')">
                        <span class="alert-icon"><svg class="ui-icon"><use href="#icon-alert"/></svg></span>
                        <span class="alert-text">Johnson v Johnson - Emergency Motion Filed</span>
                        <span class="alert-time">2 min ago</span>
                    </div>
                    <div class="ticker-item high" onclick="openTrackingCard('hearing-notice-002')">
                        <span class="alert-icon"><svg class="ui-icon"><use href="#icon-alert"/></svg></span>
                        <span class="alert-text">Hartley Estate - Court Hearing Notice</span>
                        <span class="alert-time">15 min ago</span>
                    </div>
                    <div class="ticker-item medium" onclick="openTrackingCard('document-review-003')">
                        <span class="alert-icon"><svg class="ui-icon"><use href="#icon-alert"/></svg></span>
                        <span class="alert-text">Smith Family Trust - Document Review</span>
                        <span class="alert-time">1 hour ago</span>
                    </div>
                    <div class="ticker-item low" onclick="openTrackingCard('system-status-004')">
                        <span class="alert-icon"><svg class="ui-icon"><use href="#icon-alert"/></svg></span>
                        <span class="alert-text">System: All AI providers operational</span>
                        <span class="alert-time">2 hours ago</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Widgets - Above Workflow -->
        <div class="widgets-grid">
            <!-- Today's Focus Widget - Left (wider) -->
            <div class="widget focus" onclick="expandPanel('focus')">
                <div class="widget-header">
                    <div class="widget-indicator" style="background: var(--electric-purple);"></div>
                    <h3 class="widget-title"><svg class="ui-icon"><use href="#icon-focus"/></svg>Today's Focus</h3>
                </div>
                <div class="widget-content">
                    <div class="insight-card critical">
                        <p class="insight-text"><strong>TRO Response - Johnson v Johnson</strong></p>
                        <p class="insight-subtext">Wayne County  Due 5 PM tomorrow</p>
                    </div>
                    <div class="insight-card info">
                        <p class="insight-text">Discovery Response - Hartley Estate</p>
                        <p class="insight-subtext">Oakland County  Due Friday</p>
                    </div>
                </div>
            </div>

            <!-- GoodCounsel Widget - Center (wider) - METALLIC GOLD -->
            <div class="widget goodcounsel" onclick="expandPanel('goodcounsel')">
                <div class="widget-header">
                    <div class="widget-indicator" style="background: #FFD700;"></div>
                    <h3 class="widget-title"><svg class="ui-icon"><use href="#icon-goodcounsel"/></svg>GoodCounsel</h3>
                </div>
                <div class="widget-content">
                    <div class="insight-card positive">
                        <p class="insight-text"><svg class="ui-icon"><use href="#icon-lightbulb"/></svg> No contact with James Hartley in 18 days</p>
                        <p class="insight-subtext gold">Probate hearing Dec 14</p>
                    </div>
                    <div class="insight-card positive">
                        <p class="insight-text"><svg class="ui-icon"><use href="#icon-lightbulb"/></svg> Take 10 minutes - Step outside for fresh air</p>
                        <p class="insight-subtext">You've been focused for 2.5 hours</p>
                    </div>
                </div>
            </div>

            <!-- Beta Tester Report Widget - Right (narrow) -->
            <div class="widget beta-report" id="beta-report-widget">
                <div class="widget-header">
                    <div class="widget-indicator" style="background: var(--glass-blue);"></div>
                    <h3 class="widget-title"><svg class="ui-icon"><use href="#icon-beta-circle"/></svg>Testing</h3>
                    <div class="widget-controls">
                        <button class="widget-toggle" onclick="toggleWidget('beta-report')" title="Toggle widget"></button>
                        <button class="widget-resize" onclick="resizeWidget('beta-report')" title="Resize widget"></button>
                    </div>
                </div>
                <div class="widget-content">
                    <div class="beta-checklist" id="beta-checklist">
                        <label class="beta-item"><input type="radio" name="beta-issue" value="error"> Error</label>
                        <label class="beta-item"><input type="radio" name="beta-issue" value="ui-malfunction"> UI Malfunction</label>
                        <label class="beta-item"><input type="radio" name="beta-issue" value="disconnected-service"> Disconnected Service</label>
                        <label class="beta-item"><input type="radio" name="beta-issue" value="suggestion"> Make Suggestion</label>
                        <label class="beta-item"><input type="radio" name="beta-issue" value="question"> Ask Question</label>
                        <label class="beta-item"><input type="radio" name="beta-issue" value="other"> Other Issue</label>
                    </div>
                    <button class="beta-go-btn" onclick="submitBetaChecklist()">Go</button>
                </div>
            </div>
        </div>

        <!-- Workflow Area -->
        <div class="workflow-area">
            <div class="workflow-header">
                <h2 class="workflow-title">Workflow</h2>
                <div class="widget-controls">
                    <button class="control-btn add-widget" onclick="toggleWidgetMenu()" title="Add/Remove Workflow Widgets">
                        <span class="control-icon">+</span>
                        <span class="control-text">Widgets</span>
                    </button>
                </div>
            </div>
            
            <!-- Widget Menu -->
            <div class="widget-menu" id="widget-menu" style="display: none;">
                <div class="widget-menu-header">
                    <h3>Customize Workflow</h3>
                    <button class="close-menu" onclick="toggleWidgetMenu()"></button>
                </div>
                <div class="widget-menu-content">
                    <div class="available-widgets">
                        <h4>Available Widgets</h4>
                        <div class="widget-option" data-widget="final-review" onclick="addWidget('final-review')">
                            <span class="widget-icon"></span>
                            <span class="widget-name">Final Review</span>
                            <span class="widget-desc">Final quality check</span>
                        </div>
                        <div class="widget-option" data-widget="file-serve" onclick="addWidget('file-serve')">
                            <svg class="ui-icon"><use href="#icon-file-serve"/></svg>
                            <span class="widget-name">File and Serve</span>
                            <span class="widget-desc">Document filing</span>
                        </div>
                        <div class="widget-option" data-widget="client-update" onclick="addWidget('client-update')">
                            <svg class="ui-icon"><use href="#icon-client-update"/></svg>
                            <span class="widget-name">Client Update</span>
                            <span class="widget-desc">Client communication</span>
                        </div>
                        <div class="widget-option" data-widget="progress-summary" onclick="addWidget('progress-summary')">
                            <svg class="ui-icon"><use href="#icon-progress-summary"/></svg>
                            <span class="widget-name">Progress Summary</span>
                            <span class="widget-desc">Case progress tracking</span>
                        </div>
                    </div>
                    <div class="current-widgets">
                        <h4>Current Workflow</h4>
                        <div id="current-widgets-list">
                            <!-- Dynamically populated -->
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="workflow-pipeline" id="workflow-pipeline">
                <!-- Track Elements -->
                <div class="track-brackets"></div>
                <div class="track-rail-bottom"></div>
                
                <!-- Stage 1: Intake -->
                <div class="workflow-stage intake" draggable="true" data-stage="intake" onclick="expandPanel('intake')">
                    <div class="track-connector"></div>
                    <div class="track-shoe"></div>
                    <div class="glass-surface"></div>
                    <div class="glass-reflection"></div>
                    <button class="expand-btn" onclick="event.stopPropagation(); expandPanel('intake')"></button>
                    <button class="remove-widget" onclick="event.stopPropagation(); removeWidget('intake')" title="Remove widget"></button>
                    <div class="stage-icon"><svg class="ui-icon"><use href="#icon-intake"/></svg></div>
                    <h3 class="stage-title">Document Intake</h3>
                    <p class="stage-description">Email monitoring and document capture</p>
                    <div class="stage-metrics">
                        <div class="metric-row">
                            <span class="metric-label">Today</span>
                            <span class="metric-value">24</span>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">Pending</span>
                            <span class="metric-value">3</span>
                        </div>
                    </div>
                    <div class="resize-handle"></div>
                </div>

                <!-- Connector -->
                <div class="connector-line" style="left: 332px; width: 40px;"></div>
                <div class="connector-arrow" style="left: 368px;"></div>

                <!-- Stage 2: Analysis -->
                <div class="workflow-stage analysis" draggable="true" data-stage="analysis" onclick="expandPanel('analysis')">
                    <div class="track-connector"></div>
                    <div class="track-shoe"></div>
                    <div class="glass-surface"></div>
                    <div class="glass-reflection"></div>
                    <button class="expand-btn" onclick="event.stopPropagation(); expandPanel('analysis')"></button>
                    <button class="remove-widget" onclick="event.stopPropagation(); removeWidget('analysis')" title="Remove widget"></button>
                    <div class="stage-icon"><svg class="ui-icon"><use href="#icon-analysis"/></svg></div>
                    <h3 class="stage-title">AI Analysis</h3>
                    <p class="stage-description">Document review and red flag detection</p>
                    <div class="stage-metrics">
                        <div class="metric-row">
                            <span class="metric-label">Processing</span>
                            <span class="metric-value">5</span>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">Red Flags</span>
                            <span class="metric-value">2</span>
                        </div>
                    </div>
                    <div class="resize-handle"></div>
                </div>

                <!-- Connector -->
                <div class="connector-line" style="left: 684px; width: 40px;"></div>
                <div class="connector-arrow" style="left: 720px;"></div>

                <!-- Stage 3: Draft Preparation -->
                <div class="workflow-stage review" draggable="true" data-stage="draft-prep" onclick="expandPanel('draft-prep')">
                    <div class="track-connector"></div>
                    <div class="track-shoe"></div>
                    <div class="glass-surface"></div>
                    <div class="glass-reflection"></div>
                    <button class="expand-btn" onclick="event.stopPropagation(); expandPanel('draft-prep')"></button>
                    <button class="remove-widget" onclick="event.stopPropagation(); removeWidget('draft-prep')" title="Remove widget"></button>
                    <div class="stage-icon"><svg class="ui-icon"><use href="#icon-draft"/></svg></div>
                    <h3 class="stage-title">Draft Preparation</h3>
                    <p class="stage-description">AI-generated draft responses</p>
                    <div class="stage-metrics">
                        <div class="metric-row">
                            <span class="metric-label">Drafts Ready</span>
                            <span class="metric-value">6</span>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">In Progress</span>
                            <span class="metric-value">3</span>
                        </div>
                    </div>
                    <div class="resize-handle"></div>
                </div>

                <!-- Connector -->
                <div class="connector-line" style="left: 1036px; width: 40px;"></div>
                <div class="connector-arrow" style="left: 1072px;"></div>

                <!-- Stage 4: Attorney Review -->
                <div class="workflow-stage output" draggable="true" data-stage="attorney-review" onclick="expandPanel('attorney-review')">
                    <div class="track-connector"></div>
                    <div class="track-shoe"></div>
                    <div class="glass-surface"></div>
                    <div class="glass-reflection"></div>
                    <button class="expand-btn" onclick="event.stopPropagation(); expandPanel('attorney-review')"></button>
                    <button class="remove-widget" onclick="event.stopPropagation(); removeWidget('attorney-review')" title="Remove widget"></button>
                    <div class="stage-icon"><svg class="ui-icon"><use href="#icon-attorney"/></svg></div>
                    <h3 class="stage-title">Attorney Review</h3>
                    <p class="stage-description">Final review and approval</p>
                    <div class="stage-metrics">
                        <div class="metric-row">
                            <span class="metric-label">Awaiting</span>
                            <span class="metric-value">8</span>
                        </div>
                        <div class="metric-row">
                            <span class="metric-label">Urgent</span>
                            <span class="metric-value">1</span>
                        </div>
                    </div>
                    <div class="resize-handle"></div>
                </div>
            </div>
        </div>

    </div>

    <!-- Browser Compatibility Warning -->
    <div id="browser-warning" class="browser-warning">
        <div class="browser-warning-content">
            <div class="browser-warning-text">
                <strong> Browser Compatibility Notice:</strong> This application is optimized for modern browsers. For best performance and security, please use Safari, Edge, Firefox, Opera, Brave, or DuckDuckGo. Some features may not work properly in older browsers.
            </div>
            <button class="browser-warning-close" onclick="closeBrowserWarning()"></button>
        </div>
    </div>

    <!-- Chrome Advisory -->
    <div id="chrome-advisory" class="chrome-advisory">
        <div class="chrome-advisory-content">
            <div class="chrome-advisory-text">
                <strong> Chrome Privacy Advisory:</strong> Chrome has been widely criticized for its extensive data collection practices and offers fewer built-in privacy protections than some alternatives, which may present potential risks for confidential client information. For greater privacy and security, especially in environments handling sensitive data, it is advisable to use browsers with stronger default privacy protections, such as Safari, Edge, Firefox, Opera, or Brave.
            </div>
            <button class="chrome-advisory-close" onclick="closeChromeAdvisory()"></button>
            <button class="chrome-advisory-snooze" onclick="snoozeChromeAdvisory()">Snooze 30 days</button>
        </div>
    </div>

    <!-- Combined Footer -->
    <div class="ai-error-footer">
        AI-generated content is subject to error and may be incomplete or inaccurate. Always verify all information and research results before use, especially for legal or confidential matters. The developers and Cognisint, LLC expressly disclaim liability for any harm or loss caused by AI errors. For details, review our <a href="attached_assets/ai-errors-policy.html" target="_blank">AI Errors, Fraud, and Abuse Policy</a>.<br>
        <strong>Copyright 2025 Cognisint LLC</strong> | 
        <span style="display: none;">LexFiat@cognisint.com</span>
        <span style="color: #60A5FA; text-decoration: none;">Contact: LexFiat@cognisint.com</span>
    </div>

    <!-- Tracking Card Overlay -->
    <div class="tracking-card-overlay" id="tracking-card-overlay">
        <div class="tracking-card">
            <div class="tracking-card-header">
                <h2 class="tracking-card-title" id="tracking-card-title">Item Tracking</h2>
                <button class="close-tracking-card" onclick="closeTrackingCard()"></button>
            </div>
            <div class="tracking-card-content" id="tracking-card-content">
                <!-- Content populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Help Chat Modal -->
    <div id="help-chat-overlay" class="help-chat-overlay">
        <div class="help-chat-modal">
            <div class="help-chat-header">
                <h3> LexFiat Help Assistant</h3>
                <div class="ai-provider-selector">
                    <label>AI Provider:</label>
                    <select id="help-ai-provider">
                        <option value="perplexity">Perplexity (Default)</option>
                        <option value="openai">OpenAI GPT-4</option>
                        <option value="anthropic">Anthropic Claude</option>
                        <option value="gemini">Google Gemini</option>
                    </select>
                </div>
                <button onclick="closeHelpChat()" class="close-btn"></button>
            </div>
            <div class="help-chat-content">
                <div id="help-chat-messages" class="chat-messages">
                    <div class="chat-message bot">
                        <div class="message-content">
                            Hello! I'm your LexFiat AI assistant. How can I help you today? I can assist with:
                            <ul>
                                <li>Using LexFiat features and workflows</li>
                                <li>Legal research and document analysis</li>
                                <li>Troubleshooting technical issues</li>
                                <li>Understanding GoodCounsel insights</li>
                                <li>Setting up integrations</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="chat-input-area">
                    <input type="text" id="help-chat-input" placeholder="Ask me anything about LexFiat..." />
                    <button onclick="sendHelpMessage()" class="send-btn">Send</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Report Issue Modal -->
    <div id="report-modal-overlay" class="report-modal-overlay">
        <div class="report-modal">
            <h3 id="report-modal-title">Report Issue</h3>
            <form class="report-form" id="report-form">
                <div>
                    <label for="report-type">Issue Type:</label>
                    <select id="report-type" required>
                        <option value="ui-malfunction">UI Malfunction</option>
                        <option value="disconnected-service">Disconnected Service</option>
                        <option value="suggestion">Suggestion</option>
                        <option value="question">Question</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div>
                    <label for="report-priority">Priority:</label>
                    <select id="report-priority">
                        <option value="low">Low</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                        <option value="critical">Critical</option>
                    </select>
                </div>
                <div>
                    <label for="report-description">Description:</label>
                    <textarea id="report-description" placeholder="Please describe the issue in detail..." required></textarea>
                </div>
                <div>
                    <label for="report-steps">Steps to Reproduce (if applicable):</label>
                    <textarea id="report-steps" placeholder="1. Click on...&#10;2. Navigate to...&#10;3. Error occurs..."></textarea>
                </div>
                <div>
                    <label for="report-email">Your Email (optional):</label>
                    <input type="email" id="report-email" placeholder="your.email@example.com" />
                </div>
                <div class="report-buttons">
                    <button type="button" class="cancel-btn" onclick="closeReportModal()">Cancel</button>
                    <button type="submit" class="submit-btn">Submit Report</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Expanded Panel Overlay -->
    <div class="panel-overlay" id="panel-overlay">
        <div class="expanded-panel">
            <button class="close-btn" onclick="closePanel()"> Close</button>
            <div id="expanded-content">
                <h2>Expanded Panel View</h2>
                <p>Full details would appear here...</p>
            </div>
        </div>
    </div>

    <script>
        // Drag and Drop functionality
        let draggedElement = null;

        document.querySelectorAll('.workflow-stage').forEach(stage => {
            stage.addEventListener('dragstart', (e) => {
                draggedElement = e.target;
                e.target.classList.add('dragging');
            });

            stage.addEventListener('dragend', (e) => {
                e.target.classList.remove('dragging');
            });

            stage.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.target.classList.add('drag-over');
            });

            stage.addEventListener('dragleave', (e) => {
                e.target.classList.remove('drag-over');
            });

            stage.addEventListener('drop', async (e) => {
                e.preventDefault();
                e.target.classList.remove('drag-over');
                if (draggedElement && draggedElement !== e.target) {
                    const pipeline = document.getElementById('workflow-pipeline');
                    const allStages = [...pipeline.querySelectorAll('.workflow-stage')];
                    const draggedIndex = allStages.indexOf(draggedElement);
                    const targetIndex = allStages.indexOf(e.target);
                    
                    if (draggedIndex < targetIndex) {
                        e.target.after(draggedElement);
                    } else {
                        e.target.before(draggedElement);
                    }
                    
                    // Update workflow order via Cyrano API
                    await updateWorkflowOrder();
                }
            });
        });

        // Update workflow order via Cyrano API
        async function updateWorkflowOrder() {
            try {
                const pipeline = document.getElementById('workflow-pipeline');
                const stages = [...pipeline.querySelectorAll('.workflow-stage')];
                const customStages = stages.map((stage, index) => ({
                    id: stage.dataset.stage,
                    name: stage.querySelector('.stage-title').textContent,
                    agent: getAgentForStage(stage.dataset.stage),
                    description: stage.querySelector('.stage-description').textContent,
                    order: index
                }));

                const response = await fetch('http://localhost:5002/api/tools/workflow_manager', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'customize',
                        workflow_type: 'custom',
                        custom_stages: customStages
                    })
                });

                if (response.ok) {
                    showWorkflowNotification('Workflow order updated successfully! Processing order has been changed.');
                } else {
                    console.error('Failed to update workflow order');
                    showWorkflowNotification('Failed to update workflow order. Please try again.', 'error');
                }
            } catch (error) {
                console.error('Error updating workflow order:', error);
                showWorkflowNotification('Error updating workflow order. Please check your connection.', 'error');
            }
        }

        // Get agent for workflow stage
        function getAgentForStage(stageId) {
            const agentMap = {
                'intake': 'document_processor',
                'analysis': 'document_analyzer',
                'draft-prep': 'ai_orchestrator',
                'attorney-review': 'legal_reviewer'
            };
            return agentMap[stageId] || 'ai_orchestrator';
        }

        // Show workflow reorder notification
        function showWorkflowNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `workflow-notification ${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <span class="notification-icon">${type === 'success' ? '' : ''}</span>
                    <span class="notification-text">${message}</span>
                    <button class="notification-close" onclick="this.parentElement.parentElement.remove()"></button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }

        // Widget Menu Functions
        function toggleWidgetMenu() {
            const menu = document.getElementById('widget-menu');
            if (menu.style.display === 'none') {
                menu.style.display = 'block';
                updateCurrentWidgetsList();
            } else {
                menu.style.display = 'none';
            }
        }

        function addWidget(widgetType) {
            const pipeline = document.getElementById('workflow-pipeline');
            
            // Check if widget already exists
            const existingWidget = pipeline.querySelector(`[data-stage="${widgetType}"]`);
            if (existingWidget) {
                showWorkflowNotification(`${getWidgetConfig(widgetType).name} is already in the workflow`, 'error');
                return;
            }
            
            const widgetConfig = getWidgetConfig(widgetType);
            
            // Create new workflow stage
            const newStage = document.createElement('div');
            newStage.className = `workflow-stage ${widgetConfig.type}`;
            newStage.draggable = true;
            newStage.dataset.stage = widgetType;
            newStage.onclick = () => expandPanel(widgetType);
            
            newStage.innerHTML = `
                <div class="track-connector"></div>
                <div class="track-shoe"></div>
                <div class="glass-surface"></div>
                <div class="glass-reflection"></div>
                <button class="expand-btn" onclick="event.stopPropagation(); expandPanel('${widgetType}')"></button>
                <button class="remove-widget" onclick="event.stopPropagation(); removeWidget('${widgetType}')" title="Remove widget"></button>
                <div class="stage-icon">${widgetConfig.icon}</div>
                <h3 class="stage-title">${widgetConfig.name}</h3>
                <p class="stage-description">${widgetConfig.description}</p>
                <div class="stage-metrics">
                    <div class="metric-row">
                        <span class="metric-label">Status</span>
                        <span class="metric-value">Ready</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Queue</span>
                        <span class="metric-value">0</span>
                    </div>
                </div>
                <div class="resize-handle"></div>
            `;
            
            // Add drag event listeners
            addDragListeners(newStage);
            
            // Insert before the last stage (Attorney Review)
            const lastStage = pipeline.querySelector('.workflow-stage:last-child');
            pipeline.insertBefore(newStage, lastStage);
            
            // Update workflow order
            updateWorkflowOrder();
            updateCurrentWidgetsList();
            
            showWorkflowNotification(`Added ${widgetConfig.name} to workflow`);
        }

        function removeWidget(widgetType) {
            const stage = document.querySelector(`[data-stage="${widgetType}"]`);
            if (stage) {
                stage.remove();
                updateWorkflowOrder();
                updateCurrentWidgetsList();
                showWorkflowNotification(`Removed ${widgetType} from workflow`);
            }
        }

        function getWidgetConfig(widgetType) {
            const configs = {
                'final-review': {
                    name: 'Final Review',
                    description: 'Final quality check and approval',
                    icon: '',
                    type: 'review'
                },
                'file-serve': {
                    name: 'File and Serve',
                    description: 'Document filing and service',
                    icon: '',
                    type: 'output'
                },
                'client-update': {
                    name: 'Client Update',
                    description: 'Client communication and updates',
                    icon: '',
                    type: 'communication'
                },
                'progress-summary': {
                    name: 'Progress Summary',
                    description: 'Case progress tracking and reporting',
                    icon: '',
                    type: 'analytics'
                }
            };
            return configs[widgetType] || { name: 'Unknown', description: '', icon: '', type: 'other' };
        }

        function updateCurrentWidgetsList() {
            const list = document.getElementById('current-widgets-list');
            const pipeline = document.getElementById('workflow-pipeline');
            const stages = [...pipeline.querySelectorAll('.workflow-stage')];
            
            list.innerHTML = stages.map(stage => {
                const stageId = stage.dataset.stage;
                const config = getWidgetConfig(stageId);
                return `
                    <div class="current-widget-item">
                        <span class="widget-icon">${config.icon}</span>
                        <span class="widget-name">${config.name}</span>
                        <button class="remove-widget" onclick="removeWidget('${stageId}')" title="Remove from workflow"></button>
                    </div>
                `;
            }).join('');
        }

        function addDragListeners(stage) {
            stage.addEventListener('dragstart', (e) => {
                draggedElement = e.target;
                e.target.classList.add('dragging');
            });

            stage.addEventListener('dragend', (e) => {
                e.target.classList.remove('dragging');
            });

            stage.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.target.classList.add('drag-over');
            });

            stage.addEventListener('dragleave', (e) => {
                e.target.classList.remove('drag-over');
            });

            stage.addEventListener('drop', async (e) => {
                e.preventDefault();
                e.target.classList.remove('drag-over');
                if (draggedElement && draggedElement !== e.target) {
                    const pipeline = document.getElementById('workflow-pipeline');
                    const allStages = [...pipeline.querySelectorAll('.workflow-stage')];
                    const draggedIndex = allStages.indexOf(draggedElement);
                    const targetIndex = allStages.indexOf(e.target);
                    
                    if (draggedIndex < targetIndex) {
                        e.target.after(draggedElement);
                    } else {
                        e.target.before(draggedElement);
                    }
                    
                    await updateWorkflowOrder();
                }
            });
        }

        // Sync Functions
        async function forceSync(service) {
            try {
                const response = await fetch('http://localhost:5002/api/tools/sync_manager', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'force_sync',
                        service: service
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    showWorkflowNotification(`${service} sync initiated successfully!`, 'success');
                    
                    // Update sync status display
                    updateSyncStatus(service, 'syncing', 0, 'Starting sync...');
                    
                    // Simulate progress updates
                    simulateSyncProgress(service);
                } else {
                    showWorkflowNotification(`Failed to start ${service} sync. Please try again.`, 'error');
                }
            } catch (error) {
                console.error('Error starting sync:', error);
                showWorkflowNotification(`Error starting ${service} sync. Please check your connection.`, 'error');
            }
        }

        function updateSyncStatus(service, status, progress, message) {
            const statusElement = document.getElementById(`${service}-sync-status`);
            if (statusElement) {
                const statusDot = statusElement.querySelector('div[style*="border-radius: 50%"]');
                const statusText = statusElement.querySelector('span[style*="font-weight: 500"]');
                const lastSyncText = statusElement.querySelector('span[style*="font-size: 0.85rem"]');
                const progressBar = statusElement.querySelector('div[style*="width: 100%"] > div');
                const progressText = statusElement.querySelector('span[style*="font-size: 0.85rem"]:last-child');
                
                if (statusDot) {
                    statusDot.style.background = status === 'syncing' ? 'var(--neon-orange)' : 
                                                status === 'completed' ? 'var(--cyber-green)' : '#ef4444';
                }
                
                if (statusText) {
                    statusText.textContent = `${service.charAt(0).toUpperCase() + service.slice(1)} ${status === 'syncing' ? 'Syncing' : status === 'completed' ? 'Connected' : 'Disconnected'}`;
                }
                
                if (lastSyncText) {
                    lastSyncText.textContent = status === 'syncing' ? 'Syncing now...' : 
                                             status === 'completed' ? 'Last sync: just now' : 'Last sync: unknown';
                }
                
                if (progressBar) {
                    progressBar.style.width = `${progress}%`;
                }
                
                if (progressText) {
                    progressText.textContent = `${progress}%`;
                }
            }
        }

        function simulateSyncProgress(service) {
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 20;
                if (progress >= 100) {
                    progress = 100;
                    updateSyncStatus(service, 'completed', 100, 'Sync completed');
                    clearInterval(interval);
                } else {
                    updateSyncStatus(service, 'syncing', Math.floor(progress), 'Syncing...');
                }
            }, 500);
        }

        // Widget API Functions
        async function callCyranoTool(toolName, args) {
            try {
                const response = await fetch(`http://localhost:5002/api/tools/${toolName}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(args)
                });

                if (response.ok) {
                    return await response.json();
                } else {
                    throw new Error(`API call failed: ${response.status}`);
                }
            } catch (error) {
                console.error(`Error calling ${toolName}:`, error);
                throw error;
            }
        }

        // GoodCounsel Widget Functions
        async function loadGoodCounselInsights() {
            try {
                const result = await callCyranoTool('goodcounsel', {
                    action: 'get_insights',
                    focus_areas: ['wellness', 'client_relations', 'professional_development']
                });
                
                // Update GoodCounsel widget with real data
                const widget = document.querySelector('.widget.goodcounsel .widget-content');
                if (widget && result.success) {
                    const insights = JSON.parse(result.content);
                    widget.innerHTML = `
                        <div class="insight-card positive">
                            <p class="insight-text"><svg class="ui-icon"><use href="#icon-lightbulb"/></svg> ${insights.wellness_insight || 'Take a moment to breathe and recenter'}</p>
                            <p class="insight-subtext gold">${insights.wellness_recommendation || 'You\'ve been working for 2.5 hours'}</p>
                        </div>
                        <div class="insight-card positive">
                            <p class="insight-text"><svg class="ui-icon"><use href="#icon-lightbulb"/></svg> ${insights.client_insight || 'No contact with James Hartley in 18 days'}</p>
                            <p class="insight-subtext gold">${insights.client_recommendation || 'Probate hearing Dec 14'}</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading GoodCounsel insights:', error);
            }
        }

        // Today's Focus Widget Functions
        async function loadTodaysFocus() {
            try {
                const result = await callCyranoTool('case_manager', {
                    action: 'get_urgent_tasks',
                    timeframe: 'today'
                });
                
                // Update Today's Focus widget with real data
                const widget = document.querySelector('.widget.focus .widget-content');
                if (widget && result.success) {
                    const tasks = JSON.parse(result.content);
                    widget.innerHTML = tasks.map(task => `
                        <div class="insight-card ${task.priority === 'critical' ? 'critical' : 'info'}">
                            <p class="insight-text"><strong>${task.title}</strong></p>
                            <p class="insight-subtext">${task.court}  Due ${task.deadline}</p>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Error loading today\'s focus:', error);
            }
        }

        // Performance Widget Functions
        async function loadPerformanceMetrics() {
            try {
                const result = await callCyranoTool('ai_orchestrator', {
                    action: 'get_performance_metrics',
                    timeframe: 'week'
                });
                
                // Update Performance widget with real data
                const widget = document.querySelector('.widget.performance .widget-content');
                if (widget && result.success) {
                    const metrics = JSON.parse(result.content);
                    widget.innerHTML = `
                        <div class="stat-row">
                            <span class="stat-label">Time saved</span>
                            <span class="stat-value">${metrics.time_saved || '4.7h'}</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Success</span>
                            <span class="stat-value">${metrics.success_rate || '91%'}</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Docs</span>
                            <span class="stat-value">${metrics.documents_processed || '247'}</span>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading performance metrics:', error);
            }
        }

        // Simple Ticker Function
        let currentTickerIndex = 0;
        let tickerInterval;

        function startTicker() {
            const tickerItems = document.querySelectorAll('.ticker-item');
            if (tickerItems.length === 0) return;

            // Hide all items
            tickerItems.forEach(item => item.classList.remove('active'));
            
            // Show first item
            tickerItems[0].classList.add('active');
            currentTickerIndex = 0;

            // Start rotation
            tickerInterval = setInterval(() => {
                tickerItems[currentTickerIndex].classList.remove('active');
                currentTickerIndex = (currentTickerIndex + 1) % tickerItems.length;
                tickerItems[currentTickerIndex].classList.add('active');
            }, 4000);
        }

        function stopTicker() {
            if (tickerInterval) {
                clearInterval(tickerInterval);
            }
        }

        // Red Flag Detection
        async function loadRedFlags() {
            try {
                const result = await callCyranoTool('red_flag_finder', {
                    action: 'get_red_flags'
                });
                
                // Update priority ticker with real red flags
                const tickerContent = document.getElementById('ticker-content');
                if (tickerContent && result.success) {
                    const flags = JSON.parse(result.content);
                    if (flags.red_flags && flags.red_flags.length > 0) {
                        // Stop current ticker
                        stopTicker();
                        
                        // Create ticker items
                        const tickerItems = flags.red_flags.map(flag => `
                            <div class="ticker-item ${flag.urgency}">
                                <span class="alert-icon"><svg class="ui-icon"><use href="#icon-alert"/></svg></span>
                                <span class="alert-text">${flag.description}</span>
                                <span class="alert-time">${flag.deadline || 'No deadline'}</span>
                            </div>
                        `).join('');
                        
                        tickerContent.innerHTML = tickerItems;
                        
                        // Start new ticker
                        startTicker();
                    }
                }
            } catch (error) {
                console.error('Error loading red flags:', error);
            }
        }

        // Tracking Card Functions
        async function openTrackingCard(itemId) {
            const overlay = document.getElementById('tracking-card-overlay');
            const title = document.getElementById('tracking-card-title');
            const content = document.getElementById('tracking-card-content');
            
            // Show loading state
            title.textContent = 'Loading...';
            content.innerHTML = '<div style="text-align: center; padding: 2rem; color: var(--steel-gray);">Fetching tracking data...</div>';
            overlay.style.display = 'flex';
            
            try {
                // Get tracking data for the item
                const trackingData = await getTrackingData(itemId);
                
                title.textContent = trackingData.title;
                content.innerHTML = generateTrackingCardContent(trackingData);
            } catch (error) {
                console.error('Error loading tracking data:', error);
                title.textContent = 'Error Loading Data';
                content.innerHTML = '<div style="text-align: center; padding: 2rem; color: #ef4444;">Failed to load tracking data. Please try again.</div>';
            }
        }

        function closeTrackingCard() {
            const overlay = document.getElementById('tracking-card-overlay');
            overlay.style.display = 'none';
        }

        async function getTrackingData(itemId) {
            try {
                // Call Cyrano Clio integration tool
                const result = await callCyranoTool('clio_integration', {
                    action: 'get_item_tracking',
                    item_id: itemId
                });
                
                if (result.success) {
                    const data = JSON.parse(result.content);
                    return {
                        title: data.name || 'Unknown Item',
                        itemType: data.type || 'Unknown',
                        client: data.client || 'Unknown',
                        matter: data.matter || 'Unknown',
                        clioId: data.id || 'N/A',
                        urgency: data.priority || 'low',
                        status: data.status || 'Unknown',
                        workflowStage: data.current_stage || 'Unknown',
                        nextAction: data.notes || 'Contact Support',
                        dueDate: data.next_due || 'Unknown',
                        lastActivity: data.last_activity || 'No recent activity',
                        workflowProgress: data.workflow_progress || []
                    };
                } else {
                    console.error('Error fetching tracking data:', result.error);
                    return getFallbackTrackingData(itemId);
                }
            } catch (error) {
                console.error('Error calling Cyrano API:', error);
                return getFallbackTrackingData(itemId);
            }
        }

        function getFallbackTrackingData(itemId) {
            // Fallback mock data when API fails
            const fallbackData = {
                'emergency-motion-001': {
                    title: 'Emergency Motion Response',
                    itemType: 'Motion Response',
                    client: 'Johnson v Johnson',
                    matter: 'Family Law - Divorce Proceedings',
                    clioId: 'CLIO-2024-001',
                    urgency: 'critical',
                    status: 'Draft Preparation',
                    workflowStage: 'Draft Preparation',
                    nextAction: 'Attorney Review Required',
                    dueDate: 'Tomorrow at 5:00 PM',
                    lastActivity: 'AI draft generated 2 hours ago',
                    workflowProgress: [
                        { stage: 'Document Intake', status: 'completed' },
                        { stage: 'AI Analysis', status: 'completed' },
                        { stage: 'Draft Preparation', status: 'current' },
                        { stage: 'Attorney Review', status: 'pending' }
                    ]
                },
                'hearing-notice-002': {
                    title: 'Court Hearing Notice',
                    itemType: 'Court Notice',
                    client: 'Hartley Estate',
                    matter: 'Probate Administration',
                    clioId: 'CLIO-2024-002',
                    urgency: 'high',
                    status: 'Calendar Updated',
                    workflowStage: 'Calendar Integration',
                    nextAction: 'Prepare for Hearing',
                    dueDate: 'Next Tuesday at 2:00 PM',
                    lastActivity: 'Calendar event created 15 minutes ago',
                    workflowProgress: [
                        { stage: 'Document Intake', status: 'completed' },
                        { stage: 'AI Analysis', status: 'completed' },
                        { stage: 'Calendar Integration', status: 'current' },
                        { stage: 'Attorney Review', status: 'pending' }
                    ]
                },
                'document-review-003': {
                    title: 'Client Document Review',
                    itemType: 'Document Review',
                    client: 'Smith Family Trust',
                    matter: 'Estate Planning',
                    clioId: 'CLIO-2024-003',
                    urgency: 'medium',
                    status: 'Awaiting Review',
                    workflowStage: 'AI Analysis',
                    nextAction: 'Review and Approve Documents',
                    dueDate: 'Friday at 3:00 PM',
                    lastActivity: 'Documents analyzed 1 hour ago',
                    workflowProgress: [
                        { stage: 'Document Intake', status: 'completed' },
                        { stage: 'AI Analysis', status: 'current' },
                        { stage: 'Draft Preparation', status: 'pending' },
                        { stage: 'Attorney Review', status: 'pending' }
                    ]
                },
                'system-status-004': {
                    title: 'System Status Update',
                    itemType: 'System Alert',
                    client: 'System',
                    matter: 'Infrastructure',
                    clioId: 'N/A',
                    urgency: 'low',
                    status: 'All Systems Operational',
                    workflowStage: 'Monitoring',
                    nextAction: 'Continue Monitoring',
                    dueDate: 'Ongoing',
                    lastActivity: 'Status check completed 2 hours ago',
                    workflowProgress: [
                        { stage: 'System Check', status: 'completed' },
                        { stage: 'Status Update', status: 'completed' },
                        { stage: 'Monitoring', status: 'current' }
                    ]
                }
            };
            
            return fallbackData[itemId] || {
                title: 'Unknown Item',
                itemType: 'Unknown',
                client: 'Unknown',
                matter: 'Unknown',
                clioId: 'N/A',
                urgency: 'low',
                status: 'Unknown',
                workflowStage: 'Unknown',
                nextAction: 'Contact Support',
                dueDate: 'Unknown',
                lastActivity: 'No recent activity',
                workflowProgress: []
            };
        }

        function generateTrackingCardContent(data) {
            return `
                <div class="tracking-section">
                    <h4>Item Information</h4>
                    <div class="tracking-row">
                        <span class="tracking-label">Item Type</span>
                        <span class="tracking-value">${data.itemType}</span>
                    </div>
                    <div class="tracking-row">
                        <span class="tracking-label">Client/Matter</span>
                        <span class="tracking-value">${data.client} - ${data.matter}</span>
                    </div>
                    <div class="tracking-row">
                        <span class="tracking-label">Clio ID</span>
                        <span class="tracking-value">${data.clioId}</span>
                    </div>
                    <div class="tracking-row">
                        <span class="tracking-label">Priority</span>
                        <span class="status-badge ${data.urgency}">${data.urgency.toUpperCase()}</span>
                    </div>
                </div>

                <div class="tracking-section">
                    <h4>Current Status</h4>
                    <div class="tracking-row">
                        <span class="tracking-label">Status</span>
                        <span class="tracking-value">${data.status}</span>
                    </div>
                    <div class="tracking-row">
                        <span class="tracking-label">Workflow Stage</span>
                        <span class="tracking-value">${data.workflowStage}</span>
                    </div>
                    <div class="tracking-row">
                        <span class="tracking-label">Next Action</span>
                        <span class="tracking-value">${data.nextAction}</span>
                    </div>
                    <div class="tracking-row">
                        <span class="tracking-label">Due Date</span>
                        <span class="tracking-value">${data.dueDate}</span>
                    </div>
                </div>

                <div class="tracking-section">
                    <h4>Workflow Progress</h4>
                    <div class="workflow-progress">
                        ${data.workflowProgress.map(stage => 
                            `<div class="workflow-stage ${stage.status}">${stage.stage}</div>`
                        ).join('')}
                    </div>
                </div>

                <div class="tracking-section">
                    <h4>Recent Activity</h4>
                    <div class="tracking-row">
                        <span class="tracking-label">Last Activity</span>
                        <span class="tracking-value">${data.lastActivity}</span>
                    </div>
                </div>
            `;
        }

        // Initialize all widgets on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadGoodCounselInsights();
            loadTodaysFocus();
            loadPerformanceMetrics();
            loadRedFlags();
            startTicker();
        });

        // Expand panel functionality
        function expandPanel(panelType) {
            const overlay = document.getElementById('panel-overlay');
            const content = document.getElementById('expanded-content');
            
            let panelContent = '';
            
            switch(panelType) {
                case 'ai-status':
                    panelContent = `
                        <h2>AI Provider Status</h2>
                        <div style="margin-top: 2rem; display: grid; gap: 1rem;">
                            <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(0,0,0,0.3); border-left: 3px solid var(--cyber-green);">
                                <div style="width: 12px; height: 12px; border-radius: 50%; background: var(--cyber-green);"></div>
                                <span style="flex: 1;">Perplexity</span>
                                <span style="color: var(--cyber-green);">Online</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(0,0,0,0.3); border-left: 3px solid var(--cyber-green);">
                                <div style="width: 12px; height: 12px; border-radius: 50%; background: var(--cyber-green);"></div>
                                <span style="flex: 1;">Claude 4</span>
                                <span style="color: var(--cyber-green);">Online</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(0,0,0,0.3); border-left: 3px solid var(--neon-orange);">
                                <div style="width: 12px; height: 12px; border-radius: 50%; background: var(--neon-orange);"></div>
                                <span style="flex: 1;">GPT-4</span>
                                <span style="color: var(--neon-orange);">API Key Required</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(0,0,0,0.3); border-left: 3px solid #ef4444;">
                                <div style="width: 12px; height: 12px; border-radius: 50%; background: #ef4444;"></div>
                                <span style="flex: 1;">Gemini Pro</span>
                                <span style="color: #ef4444;">Offline</span>
                            </div>
                        </div>
                    `;
                    break;
                case 'gmail':
                    panelContent = `
                        <h2>Gmail Sync Status</h2>
                        <div style="margin-top: 2rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                                <h3>Sync Status</h3>
                                <button onclick="forceSync('gmail')" style="padding: 0.75rem 1.5rem; background: var(--cyber-green); border: 1px solid var(--cyber-green); border-radius: 0; color: white; cursor: pointer;">
                                     Force Sync
                                </button>
                            </div>
                            
                            <div id="gmail-sync-status" style="padding: 1rem; background: rgba(0,0,0,0.3); border-left: 3px solid var(--cyber-green); margin-bottom: 1rem;">
                                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
                                    <div style="width: 12px; height: 12px; border-radius: 50%; background: var(--cyber-green);"></div>
                                    <span style="font-weight: 500;">Gmail Connected</span>
                                    <span style="color: var(--cyber-green); font-size: 0.85rem;">Last sync: 2 minutes ago</span>
                                </div>
                                <div style="margin-top: 0.5rem;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                                        <span style="font-size: 0.85rem; color: var(--steel-gray);">Sync Progress</span>
                                        <span style="font-size: 0.85rem; color: var(--cyber-green);">100%</span>
                                    </div>
                                    <div style="width: 100%; height: 4px; background: rgba(0,0,0,0.3); border-radius: 2px;">
                                        <div style="width: 100%; height: 100%; background: var(--cyber-green); border-radius: 2px;"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="margin-top: 1.5rem;">
                                <h4 style="margin-bottom: 1rem; color: var(--chrome);">Recent Emails</h4>
                                <div style="padding: 1rem; background: rgba(0,0,0,0.3); margin-bottom: 1rem; border-left: 3px solid var(--glass-blue);">
                                    <strong>Johnson v Johnson - Discovery Request</strong>
                                    <p style="font-size: 0.85rem; color: var(--steel-gray); margin-top: 0.5rem;">Received 2 hours ago</p>
                                </div>
                                <div style="padding: 1rem; background: rgba(0,0,0,0.3); margin-bottom: 1rem; border-left: 3px solid var(--neon-orange);">
                                    <strong>Court Notice - Hartley Estate</strong>
                                    <p style="font-size: 0.85rem; color: var(--steel-gray); margin-top: 0.5rem;">Received 4 hours ago</p>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'calendar':
                    panelContent = `
                        <h2>Calendar Sync Status</h2>
                        <div style="margin-top: 2rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                                <h3>Sync Status</h3>
                                <button onclick="forceSync('calendar')" style="padding: 0.75rem 1.5rem; background: var(--cyber-green); border: 1px solid var(--cyber-green); border-radius: 0; color: white; cursor: pointer;">
                                     Force Sync
                                </button>
                            </div>
                            
                            <div id="calendar-sync-status" style="padding: 1rem; background: rgba(0,0,0,0.3); border-left: 3px solid var(--cyber-green); margin-bottom: 1rem;">
                                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
                                    <div style="width: 12px; height: 12px; border-radius: 50%; background: var(--cyber-green);"></div>
                                    <span style="font-weight: 500;">Calendar Connected</span>
                                    <span style="color: var(--cyber-green); font-size: 0.85rem;">Last sync: 5 minutes ago</span>
                                </div>
                                <div style="margin-top: 0.5rem;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                                        <span style="font-size: 0.85rem; color: var(--steel-gray);">Sync Progress</span>
                                        <span style="font-size: 0.85rem; color: var(--cyber-green);">100%</span>
                                    </div>
                                    <div style="width: 100%; height: 4px; background: rgba(0,0,0,0.3); border-radius: 2px;">
                                        <div style="width: 100%; height: 100%; background: var(--cyber-green); border-radius: 2px;"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="margin-top: 1.5rem;">
                                <h4 style="margin-bottom: 1rem; color: var(--chrome);">Upcoming Events</h4>
                                <div style="padding: 1rem; background: rgba(0,0,0,0.3); margin-bottom: 1rem; border-left: 3px solid var(--neon-orange);">
                                    <strong>Johnson v Johnson - Discovery Hearing</strong>
                                    <p style="font-size: 0.85rem; color: var(--steel-gray); margin-top: 0.5rem;">Tomorrow at 2:00 PM</p>
                                </div>
                                <div style="padding: 1rem; background: rgba(0,0,0,0.3); margin-bottom: 1rem; border-left: 3px solid var(--glass-blue);">
                                    <strong>Hartley Estate - Settlement Conference</strong>
                                    <p style="font-size: 0.85rem; color: var(--steel-gray); margin-top: 0.5rem;">Friday at 10:00 AM</p>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'research':
                    panelContent = `
                        <h2>Legal Research Sync Status</h2>
                        <div style="margin-top: 2rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                                <h3>Research Platforms</h3>
                                <button onclick="forceSync('westlaw')" style="padding: 0.75rem 1.5rem; background: var(--cyber-green); border: 1px solid var(--cyber-green); border-radius: 0; color: white; cursor: pointer;">
                                     Sync All
                                </button>
                            </div>
                            
                            <div style="display: grid; gap: 1rem; margin-bottom: 2rem;">
                                <div id="westlaw-sync-status" style="padding: 1rem; background: rgba(0,0,0,0.3); border-left: 3px solid var(--cyber-green);">
                                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
                                        <div style="width: 12px; height: 12px; border-radius: 50%; background: var(--cyber-green);"></div>
                                        <span style="font-weight: 500;">Westlaw Connected</span>
                                        <span style="color: var(--cyber-green); font-size: 0.85rem;">Last sync: 1 hour ago</span>
                                    </div>
                                    <div style="margin-top: 0.5rem;">
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                                            <span style="font-size: 0.85rem; color: var(--steel-gray);">Sync Progress</span>
                                            <span style="font-size: 0.85rem; color: var(--cyber-green);">100%</span>
                                        </div>
                                        <div style="width: 100%; height: 4px; background: rgba(0,0,0,0.3); border-radius: 2px;">
                                            <div style="width: 100%; height: 100%; background: var(--cyber-green); border-radius: 2px;"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div id="lexis-sync-status" style="padding: 1rem; background: rgba(0,0,0,0.3); border-left: 3px solid var(--neon-orange);">
                                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
                                        <div style="width: 12px; height: 12px; border-radius: 50%; background: var(--neon-orange);"></div>
                                        <span style="font-weight: 500;">LexisNexis Connected</span>
                                        <span style="color: var(--neon-orange); font-size: 0.85rem;">Last sync: 3 hours ago</span>
                                    </div>
                                    <div style="margin-top: 0.5rem;">
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                                            <span style="font-size: 0.85rem; color: var(--steel-gray);">Sync Progress</span>
                                            <span style="font-size: 0.85rem; color: var(--neon-orange);">85%</span>
                                        </div>
                                        <div style="width: 100%; height: 4px; background: rgba(0,0,0,0.3); border-radius: 2px;">
                                            <div style="width: 85%; height: 100%; background: var(--neon-orange); border-radius: 2px;"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div id="fastcase-sync-status" style="padding: 1rem; background: rgba(0,0,0,0.3); border-left: 3px solid #ef4444;">
                                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
                                        <div style="width: 12px; height: 12px; border-radius: 50%; background: #ef4444;"></div>
                                        <span style="font-weight: 500;">Fastcase Disconnected</span>
                                        <span style="color: #ef4444; font-size: 0.85rem;">API Key Required</span>
                                    </div>
                                    <button style="padding: 0.5rem 1rem; background: rgba(59, 130, 246, 0.2); border: 1px solid var(--glass-blue); border-radius: 0; color: white; cursor: pointer; margin-top: 0.5rem;">Connect Fastcase</button>
                                </div>
                            </div>
                            
                            <div style="margin-top: 1.5rem;">
                                <h4 style="margin-bottom: 1rem; color: var(--chrome);">Recent Research</h4>
                                <div style="padding: 1rem; background: rgba(0,0,0,0.3); margin-bottom: 1rem; border-left: 3px solid var(--glass-blue);">
                                    <strong>Michigan Family Law - Discovery Standards</strong>
                                    <p style="font-size: 0.85rem; color: var(--steel-gray); margin-top: 0.5rem;">Searched 2 hours ago via Westlaw</p>
                                </div>
                                <div style="padding: 1rem; background: rgba(0,0,0,0.3); margin-bottom: 1rem; border-left: 3px solid var(--neon-orange);">
                                    <strong>Estate Administration - Probate Procedures</strong>
                                    <p style="font-size: 0.85rem; color: var(--steel-gray); margin-top: 0.5rem;">Searched 4 hours ago via LexisNexis</p>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                case 'admin':
                    panelContent = `
                        <h2 style="color: var(--neon-orange);"> Admin Panel - User Management</h2>
                        
                        <div style="margin-top: 2rem;">
                            <!-- Admin Actions -->
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                                <h3>System Users</h3>
                                <button onclick="showCreateUserForm()" style="padding: 0.75rem 1.5rem; background: var(--cyber-green); border: 1px solid var(--cyber-green); border-radius: 0; color: white; cursor: pointer;">
                                     Add New User
                                </button>
                            </div>

                            <!-- User List Table -->
                            <div style="background: rgba(0,0,0,0.3); border-radius: 0; overflow: hidden;">
                                <table style="width: 100%; border-collapse: collapse;">
                                    <thead style="background: rgba(59, 130, 246, 0.2); border-bottom: 2px solid var(--glass-blue);">
                                        <tr>
                                            <th style="padding: 1rem; text-align: left; color: var(--chrome);">Username</th>
                                            <th style="padding: 1rem; text-align: left; color: var(--chrome);">Email</th>
                                            <th style="padding: 1rem; text-align: left; color: var(--chrome);">Name</th>
                                            <th style="padding: 1rem; text-align: left; color: var(--chrome);">Status</th>
                                            <th style="padding: 1rem; text-align: left; color: var(--chrome);">Last Login</th>
                                            <th style="padding: 1rem; text-align: left; color: var(--chrome);">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr style="border-bottom: 1px solid var(--panel-border);">
                                            <td style="padding: 1rem; color: var(--white);">davidtowne</td>
                                            <td style="padding: 1rem; color: var(--steel-gray);">admin@lexfiat.com</td>
                                            <td style="padding: 1rem; color: var(--white);">David Towne</td>
                                            <td style="padding: 1rem;">
                                                <span style="padding: 0.25rem 0.75rem; background: rgba(16, 185, 129, 0.2); border: 1px solid var(--cyber-green); color: var(--cyber-green); font-size: 0.75rem; border-radius: 0;">ACTIVE</span>
                                            </td>
                                            <td style="padding: 1rem; color: var(--steel-gray); font-family: monospace;">2025-01-09 08:30</td>
                                            <td style="padding: 1rem;">
                                                <button style="padding: 0.5rem; background: rgba(168, 85, 247, 0.2); border: 1px solid var(--electric-purple); border-radius: 0; color: white; cursor: pointer; margin-right: 0.5rem;">Edit</button>
                                                <button style="padding: 0.5rem; background: rgba(245, 158, 11, 0.2); border: 1px solid var(--neon-orange); border-radius: 0; color: white; cursor: pointer; margin-right: 0.5rem;">Reset PW</button>
                                            </td>
                                        </tr>
                                        <tr style="border-bottom: 1px solid var(--panel-border);">
                                            <td style="padding: 1rem; color: var(--white);">mmiller</td>
                                            <td style="padding: 1rem; color: var(--steel-gray);">mekel@lawfirm.com</td>
                                            <td style="padding: 1rem; color: var(--white);">Mekel S. Miller</td>
                                            <td style="padding: 1rem;">
                                                <span style="padding: 0.25rem 0.75rem; background: rgba(16, 185, 129, 0.2); border: 1px solid var(--cyber-green); color: var(--cyber-green); font-size: 0.75rem; border-radius: 0;">ACTIVE</span>
                                            </td>
                                            <td style="padding: 1rem; color: var(--steel-gray); font-family: monospace;">2025-01-09 14:22</td>
                                            <td style="padding: 1rem;">
                                                <button style="padding: 0.5rem; background: rgba(168, 85, 247, 0.2); border: 1px solid var(--electric-purple); border-radius: 0; color: white; cursor: pointer; margin-right: 0.5rem;">Edit</button>
                                                <button style="padding: 0.5rem; background: rgba(245, 158, 11, 0.2); border: 1px solid var(--neon-orange); border-radius: 0; color: white; cursor: pointer; margin-right: 0.5rem;">Reset PW</button>
                                                <button style="padding: 0.5rem; background: rgba(239, 68, 68, 0.2); border: 1px solid #ef4444; border-radius: 0; color: white; cursor: pointer;">Delete</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Authorized Emails Section -->
                            <div style="margin-top: 2rem;">
                                <h3 style="margin-bottom: 1rem;">Authorized Email Domains</h3>
                                <div style="background: rgba(0,0,0,0.3); padding: 1.5rem; border-radius: 0; border-left: 3px solid var(--cyber-green);">
                                    <ul style="list-style: none; padding: 0; display: grid; gap: 0.5rem;">
                                        <li style="display: flex; align-items: center; gap: 0.5rem;">
                                            <span style="width: 8px; height: 8px; background: var(--cyber-green); border-radius: 50%;"></span>
                                            <span>@lexfiat.com</span>
                                        </li>
                                        <li style="display: flex; align-items: center; gap: 0.5rem;">
                                            <span style="width: 8px; height: 8px; background: var(--cyber-green); border-radius: 50%;"></span>
                                            <span>@lawfirm.com</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>

                            <!-- System Info -->
                            <div style="margin-top: 2rem; display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 0; border-left: 3px solid var(--glass-blue);">
                                    <div style="font-size: 0.85rem; color: var(--steel-gray); margin-bottom: 0.5rem;">Total Users</div>
                                    <div style="font-size: 2rem; font-weight: 600; font-family: monospace;">2</div>
                                </div>
                                <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 0; border-left: 3px solid var(--cyber-green);">
                                    <div style="font-size: 0.85rem; color: var(--steel-gray); margin-bottom: 0.5rem;">Active Sessions</div>
                                    <div style="font-size: 2rem; font-weight: 600; font-family: monospace;">2</div>
                                </div>
                            </div>

                            <!-- Admin Notes -->
                            <div style="margin-top: 2rem; padding: 1rem; background: rgba(245, 158, 11, 0.1); border: 1px solid var(--neon-orange); border-radius: 0;">
                                <strong style="color: var(--neon-orange);"> Admin Notes:</strong>
                                <ul style="margin-top: 0.5rem; padding-left: 1.5rem; color: var(--steel-gray);">
                                    <li>Admin users (davidtowne) cannot be deleted</li>
                                    <li>Password reset emails will be sent to user's registered email</li>
                                    <li>New users must use authorized email domains</li>
                                    <li>All admin actions are logged for security audit</li>
                                </ul>
                            </div>
                        </div>
                    `;
                    break;
                case 'settings':
                    panelContent = `
                        <h2>Settings</h2>
                        <p style="margin-top: 1rem; color: var(--steel-gray);">Application preferences and configuration...</p>
                    `;
                    break;
                case 'goodcounsel':
                    panelContent = `
                        <h2 style="color: #FFD700; text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);"> GoodCounsel - Your Wellness & Growth Sanctuary</h2>
                        <p style="margin-top: 1rem; color: var(--steel-gray); font-style: italic;">Supporting your practice, your relationships, and your wellbeing</p>
                        
                        <div style="margin-top: 2rem; display: grid; gap: 2rem;">
                            <!-- Client Relationship Insight -->
                            <div style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.25) 0%, rgba(16, 185, 129, 0.15) 100%); padding: 2rem; border-left: 4px solid #FFD700; border-radius: 0; box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);">
                                <div style="display: flex; align-items: start; gap: 1rem; margin-bottom: 1rem;">
                                    <div style="font-size: 2rem; filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.5));"></div>
                                    <div style="flex: 1;">
                                        <h3 style="color: #FFD700; margin-bottom: 0.5rem; text-shadow: 0 0 8px rgba(255, 215, 0, 0.4);">Client Check-in: James Hartley</h3>
                                        <div style="color: var(--steel-gray); font-size: 0.85rem; margin-bottom: 1rem;">Probate Matter  Hartley Estate</div>
                                    </div>
                                </div>
                                
                                <div style="background: rgba(0,0,0,0.4); padding: 1.5rem; border-radius: 0; margin-bottom: 1.5rem; border: 1px solid rgba(255, 215, 0, 0.2);">
                                    <p style="line-height: 1.6; margin-bottom: 1rem;">
                                        You haven't spoken to <strong style="color: #FFD700;">James Hartley</strong> in <strong style="color: #FFD700;">18 days</strong>, and there's a probate hearing coming up for his brother's estate on <strong style="color: var(--cyber-green);">December 14th</strong>.
                                    </p>
                                    <p style="line-height: 1.6; margin-bottom: 1rem; color: var(--chrome);">
                                        Based on your past interactions, James tends to get anxious before hearings. In your last three hearings with him, he sent multiple worried emails and phone calls in the 48 hours leading up to court dates.
                                    </p>
                                    <p style="line-height: 1.6; color: var(--cyber-green);">
                                        <strong> Proactive Suggestion:</strong> If you make a quick <strong>5-minute phone call</strong> to him this afternoon to review the hearing details and reassure him about the process, it may head off a wave of panicked emails and phone calls over the weekend.
                                    </p>
                                </div>

                                <div style="display: flex; gap: 1rem;">
                                    <button style="flex: 1; padding: 1rem; background: var(--cyber-green); border: 1px solid var(--cyber-green); border-radius: 0; color: white; cursor: pointer; font-weight: 600;">
                                         Schedule Call for This Afternoon
                                    </button>
                                    <button style="flex: 1; padding: 1rem; background: rgba(255, 215, 0, 0.3); border: 1px solid #FFD700; border-radius: 0; color: white; cursor: pointer;">
                                         Send Reassurance Email Instead
                                    </button>
                                    <button style="padding: 1rem; background: rgba(0,0,0,0.3); border: 1px solid var(--panel-border); border-radius: 0; color: var(--steel-gray); cursor: pointer;">
                                        Dismiss
                                    </button>
                                </div>
                            </div>

                            <!-- Wellness Break Reminder -->
                            <div style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.25) 0%, rgba(16, 185, 129, 0.15) 100%); padding: 2rem; border-left: 4px solid #FFD700; border-radius: 0; box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);">
                                <div style="display: flex; align-items: start; gap: 1rem; margin-bottom: 1rem;">
                                    <div style="font-size: 2rem; filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.5));"></div>
                                    <div style="flex: 1;">
                                        <h3 style="color: #FFD700; margin-bottom: 0.5rem; text-shadow: 0 0 8px rgba(255, 215, 0, 0.4);">Wellness Check: Time for a Break</h3>
                                        <div style="color: var(--steel-gray); font-size: 0.85rem; margin-bottom: 1rem;">You've been in deep focus for 2.5 hours</div>
                                    </div>
                                </div>
                                
                                <div style="background: rgba(0,0,0,0.4); padding: 1.5rem; border-radius: 0; margin-bottom: 1.5rem; border: 1px solid rgba(255, 215, 0, 0.2);">
                                    <p style="line-height: 1.6; margin-bottom: 1rem;">
                                        You've been working intensely on the Johnson TRO response since 11:45 AM without a break. Research shows that cognitive performance and decision-making quality decline significantly after 90-120 minutes of sustained focus.
                                    </p>
                                    <p style="line-height: 1.6; color: var(--cyber-green);">
                                        <strong> Wellness Recommendation:</strong> Take <strong>10 minutes</strong> to step outside for fresh air and sunlight. A brief walk will help restore your mental clarity and may actually help you spot issues in the TRO response you might otherwise miss.
                                    </p>
                                </div>

                                <div style="display: flex; gap: 1rem;">
                                    <button style="flex: 1; padding: 1rem; background: var(--cyber-green); border: 1px solid var(--cyber-green); border-radius: 0; color: white; cursor: pointer; font-weight: 600;">
                                         I'll Take a 10-Minute Break Now
                                    </button>
                                    <button style="padding: 1rem; background: rgba(0,0,0,0.3); border: 1px solid var(--panel-border); border-radius: 0; color: var(--steel-gray); cursor: pointer;">
                                         Remind Me in 30 Minutes
                                    </button>
                                </div>
                            </div>

                            <!-- Professional Development Opportunity -->
                            <div style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.25) 0%, rgba(168, 85, 247, 0.15) 100%); padding: 2rem; border-left: 4px solid #FFD700; border-radius: 0; box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);">
                                <div style="display: flex; align-items: start; gap: 1rem; margin-bottom: 1rem;">
                                    <div style="font-size: 2rem; filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.5));"></div>
                                    <div style="flex: 1;">
                                        <h3 style="color: #FFD700; margin-bottom: 0.5rem; text-shadow: 0 0 8px rgba(255, 215, 0, 0.4);">Growth Opportunity: CLE Course</h3>
                                        <div style="color: var(--steel-gray); font-size: 0.85rem; margin-bottom: 1rem;">Professional Development</div>
                                    </div>
                                </div>
                                
                                <div style="background: rgba(0,0,0,0.4); padding: 1.5rem; border-radius: 0; margin-bottom: 1.5rem; border: 1px solid rgba(255, 215, 0, 0.2);">
                                    <p style="line-height: 1.6; margin-bottom: 1rem;">
                                        ICLE is offering a CLE on <strong style="color: #FFD700;">"Emergency Family Court Procedures"</strong> on December 17th. Given your recent increase in TRO and emergency custody matters (4 in the past 2 months vs. your usual 1-2), this could be valuable continuing education.
                                    </p>
                                    <p style="line-height: 1.6; color: #FFD700;">
                                        <strong> Growth Note:</strong> You mentioned wanting to handle more high-stakes family law matters. This CLE would strengthen your expertise in this exact area while fulfilling your annual CLE requirements.
                                    </p>
                                </div>

                                <div style="display: flex; gap: 1rem;">
                                    <button style="flex: 1; padding: 1rem; background: rgba(255, 215, 0, 0.3); border: 1px solid #FFD700; border-radius: 0; color: white; cursor: pointer; font-weight: 600;">
                                         Register for CLE Course
                                    </button>
                                    <button style="padding: 1rem; background: rgba(0,0,0,0.3); border: 1px solid var(--panel-border); border-radius: 0; color: var(--steel-gray); cursor: pointer;">
                                        Maybe Later
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- GoodCounsel Footer -->
                        <div style="margin-top: 3rem; padding: 1.5rem; background: rgba(255, 215, 0, 0.15); border: 1px solid rgba(255, 215, 0, 0.4); border-radius: 0; text-align: center; box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);">
                            <p style="color: var(--chrome); font-style: italic;">
                                "Taking care of your clients starts with taking care of yourself. Building a sustainable practice means building sustainable habits."
                            </p>
                        </div>
                    `;
                    break;
                case 'profile':
                    panelContent = `
                        <h2>Attorney Profile</h2>
                        <div style="margin-top: 2rem;">
                            <div style="text-align: center; margin-bottom: 2rem;">
                                <div style="width: 150px; height: 150px; border-radius: 50%; border: 3px solid var(--gold); margin: 0 auto; overflow: hidden;">
                                    <img src="attached_assets/IMG_0104_1754179760418.JPG" style="width: 100%; height: 100%; object-fit: cover;">
                                </div>
                                <button style="margin-top: 1rem; padding: 0.75rem 1.5rem; background: var(--accent-glow); border: 1px solid var(--glass-blue); border-radius: 0; color: white; cursor: pointer;">Upload New Photo</button>
                            </div>
                            <div style="display: grid; gap: 1rem;">
                                <div><label>Name:</label><br><input type="text" value="Mekel S. Miller" style="width: 100%; padding: 0.75rem; background: rgba(0,0,0,0.3); border: 1px solid var(--panel-border); color: white; margin-top: 0.5rem;"></div>
                                <div><label>Specialization:</label><br><input type="text" value="Family Law" style="width: 100%; padding: 0.75rem; background: rgba(0,0,0,0.3); border: 1px solid var(--panel-border); color: white; margin-top: 0.5rem;"></div>
                            </div>
                        </div>
                    `;
                    break;
                case 'clio':
                    panelContent = `
                        <h2>Clio Integration</h2>
                        <div style="margin-top: 1rem; background: rgba(0,0,0,0.3); padding: 1rem; border-left: 3px solid var(--glass-blue);">
                            <div style="display:flex;align-items:center;gap:0.75rem;">
                                <div class="status-dot" id="clio-panel-dot" style="width:10px;height:10px;border-radius:50%; background: var(--neon-orange);"></div>
                                <span id="clio-connection-status" style="font-weight:500;">Checking status</span>
                            </div>
                            <div style="margin-top:0.75rem;color:var(--steel-gray);font-size:0.9rem;">
                                To enable real connectivity, set environment variable <code>CLIO_API_KEY</code> on the integration server.
                            </div>
                        </div>
                    `;
                    break;
                default:
                    panelContent = `
                        <h2>${panelType.charAt(0).toUpperCase() + panelType.slice(1)} - Full View</h2>
                        <p style="margin-top: 1rem; color: var(--steel-gray);">This is the expanded panel for ${panelType}.</p>
                        <p style="margin-top: 1rem;">Full functionality and detailed information would be displayed here...</p>
                    `;
            }
            
            content.innerHTML = panelContent;
            overlay.classList.add('active');
            if (panelType === 'clio') {
                updateClioStatus();
            }
        }

        function closePanel() {
            document.getElementById('panel-overlay').classList.remove('active');
        }

        // Close on overlay click
        document.getElementById('panel-overlay').addEventListener('click', (e) => {
            if (e.target.id === 'panel-overlay') {
                closePanel();
            }
        });

        // ESC key to close
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closePanel();
            }
        });

        // Rotating Slogans
        const slogans = [
            'The Power of Clarity',
            'See the Things that Matter', 
            'Intelligence + Insight = Illumination'
        ];
        let currentSloganIndex = 0;

        function rotateSlogan() {
            const sloganElement = document.getElementById('rotating-slogan');
            if (sloganElement) {
                sloganElement.style.opacity = '0';
                setTimeout(() => {
                    currentSloganIndex = (currentSloganIndex + 1) % slogans.length;
                    sloganElement.textContent = slogans[currentSloganIndex];
                    sloganElement.style.opacity = '1';
                }, 300);
            }
        }

        // Start rotating slogans every 8 seconds
        setInterval(rotateSlogan, 90000);

        // Make admin button draggable as a widget
        function makeAdminButtonDraggable() {
            const adminButton = document.querySelector('.action-btn.admin');
            if (adminButton) {
                adminButton.draggable = true;
                adminButton.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', 'admin-widget');
                    e.dataTransfer.effectAllowed = 'move';
                });
            }
        }

        // Widget Control Functions
        function toggleWidget(widgetId) {
            const widget = document.getElementById(widgetId + '-widget');
            if (widget) {
                const content = widget.querySelector('.widget-content');
                const toggleBtn = widget.querySelector('.widget-toggle');
                
                if (content.style.display === 'none') {
                    content.style.display = 'block';
                    toggleBtn.textContent = '';
                } else {
                    content.style.display = 'none';
                    toggleBtn.textContent = '+';
                }
            }
        }

        function resizeWidget(widgetId) {
            const widget = document.getElementById(widgetId + '-widget');
            if (widget) {
                // Toggle between different size presets
                const currentSize = widget.dataset.size || 'normal';
                const sizes = {
                    'normal': 'compact',
                    'compact': 'expanded',
                    'expanded': 'normal'
                };
                
                const newSize = sizes[currentSize];
                widget.dataset.size = newSize;
                
                // Apply size-specific styles
                switch (newSize) {
                    case 'compact':
                        widget.style.minWidth = '200px';
                        widget.style.maxWidth = '300px';
                        break;
                    case 'expanded':
                        widget.style.minWidth = '400px';
                        widget.style.maxWidth = '600px';
                        break;
                    default:
                        widget.style.minWidth = '250px';
                        widget.style.maxWidth = '400px';
                }
            }
        }

        // Cyrano API Integration
        async function callCyranoTool(toolName, parameters) {
            try {
                const response = await fetch('/api/cyrano', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        tool: toolName,
                        parameters: parameters
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                return result;
            } catch (error) {
                console.error('Cyrano API call failed:', error);
                // Return fallback data for development
                return getFallbackData(toolName, parameters);
            }
        }

        function getFallbackData(toolName, parameters) {
            const fallbackData = {
                'red_flag_finder': {
                    success: true,
                    content: JSON.stringify({
                        red_flags: [
                            {
                                description: 'Emergency Motion Response - Johnson v Johnson',
                                urgency: 'critical',
                                recommended_action: 'Prepare immediate response',
                                deadline: '24 hours',
                                consequences: 'Default judgment if not responded to',
                                source_text: 'Emergency motion for temporary restraining order'
                            },
                            {
                                description: 'Court Hearing Notice - Hartley Estate',
                                urgency: 'high',
                                recommended_action: 'Prepare for hearing',
                                deadline: 'Next Tuesday at 2:00 PM',
                                consequences: 'Missed hearing if not prepared',
                                source_text: 'Probate hearing scheduled'
                            }
                        ],
                        analysis_summary: 'Critical and high priority items detected',
                        timestamp: new Date().toISOString()
                    })
                },
                'goodcounsel': {
                    success: true,
                    content: JSON.stringify({
                        client_insight: 'No contact with James Hartley in 18 days',
                        client_recommendation: 'Probate hearing Dec 14',
                        wellness_insight: 'You\'ve been in deep focus for 2.5 hours',
                        wellness_recommendation: 'Take a 10-minute break for fresh air',
                        growth_insight: 'CLE course on Emergency Family Court Procedures available',
                        growth_recommendation: 'Register for December 17th ICLE course'
                    })
                },
                'case_manager': {
                    success: true,
                    content: JSON.stringify([
                        {
                            title: 'Emergency Motion Response',
                            priority: 'critical',
                            court: 'Wayne County Circuit',
                            deadline: 'Tomorrow at 5:00 PM'
                        },
                        {
                            title: 'Probate Hearing Preparation',
                            priority: 'high',
                            court: 'Oakland County Probate',
                            deadline: 'Next Tuesday at 2:00 PM'
                        }
                    ])
                },
                'ai_orchestrator': {
                    success: true,
                    content: JSON.stringify({
                        time_saved: '4.7h',
                        documents_processed: '23',
                        accuracy_rate: '94%',
                        efficiency_gain: '+28%'
                    })
                },
                'sync_manager': {
                    success: true,
                    content: JSON.stringify({
                        status: 'completed',
                        progress: 100,
                        last_sync: new Date().toISOString(),
                        services: ['clio', 'gmail', 'calendar', 'westlaw']
                    })
                }
            };
            
            return fallbackData[toolName] || { success: false, content: '{}' };
        }

        // Help Chat Functions
        function openHelpChat() {
            document.getElementById('help-chat-overlay').style.display = 'flex';
        }

        function closeHelpChat() {
            document.getElementById('help-chat-overlay').style.display = 'none';
        }

        function sendHelpMessage() {
            const input = document.getElementById('help-chat-input');
            const messages = document.getElementById('help-chat-messages');
            const provider = document.getElementById('help-ai-provider').value;
            
            if (!input.value.trim()) return;
            
            // Add user message
            const userMessage = document.createElement('div');
            userMessage.className = 'chat-message user';
            userMessage.innerHTML = `<div class="message-content">${input.value}</div>`;
            messages.appendChild(userMessage);
            
            const userQuestion = input.value;
            input.value = '';
            
            // Add loading message
            const loadingMessage = document.createElement('div');
            loadingMessage.className = 'chat-message bot';
            loadingMessage.innerHTML = '<div class="message-content"> Thinking...</div>';
            messages.appendChild(loadingMessage);
            
            // Scroll to bottom
            messages.scrollTop = messages.scrollHeight;
            
            // Simulate AI response (in real implementation, this would call Cyrano)
            setTimeout(() => {
                loadingMessage.remove();
                
                const botMessage = document.createElement('div');
                botMessage.className = 'chat-message bot';
                botMessage.innerHTML = `<div class="message-content">${getHelpResponse(userQuestion, provider)}</div>`;
                messages.appendChild(botMessage);
                
                messages.scrollTop = messages.scrollHeight;
            }, 1500);
        }

        function getHelpResponse(question, provider) {
            const responses = {
                'perplexity': 'Based on your question, I can help you with that. Let me search for the most current information...',
                'openai': 'I understand your question. Here\'s what I can tell you about that topic...',
                'anthropic': 'Thank you for your question. Let me provide you with a helpful response...',
                'gemini': 'I\'ll help you with that. Let me analyze your question and provide guidance...'
            };
            
            const baseResponse = responses[provider] || responses['perplexity'];
            
            // Simple keyword-based responses (in real implementation, this would be AI-powered)
            if (question.toLowerCase().includes('workflow')) {
                return baseResponse + ' LexFiat workflows help automate your legal processes. You can drag and drop widgets to customize your workflow, and each stage connects to AI tools for document processing, analysis, and review.';
            } else if (question.toLowerCase().includes('goodcounsel')) {
                return baseResponse + ' GoodCounsel is your wellness and growth module. It provides client relationship insights, wellness recommendations, and professional development suggestions to help you build a sustainable practice.';
            } else if (question.toLowerCase().includes('integration')) {
                return baseResponse + ' LexFiat integrates with Clio, Gmail, Westlaw, and other legal tools. Go to Settings to configure your API keys and enable integrations.';
            } else if (question.toLowerCase().includes('error') || question.toLowerCase().includes('problem')) {
                return baseResponse + ' If you\'re experiencing technical issues, try refreshing the page or checking your internet connection. For persistent problems, use the "Report an Issue" widget to contact our development team.';
            } else {
                return baseResponse + ' I\'m here to help with any LexFiat questions. You can ask about features, workflows, integrations, or troubleshooting. What specific aspect would you like to know more about?';
            }
        }

        // Report Modal Functions
        function openReportModal(type) {
            const modal = document.getElementById('report-modal-overlay');
            const title = document.getElementById('report-modal-title');
            const typeSelect = document.getElementById('report-type');
            
            // Set the issue type
            typeSelect.value = type;
            
            // Update title based on type
            const titles = {
                'ui-malfunction': ' Report UI Malfunction',
                'disconnected-service': ' Report Disconnected Service',
                'suggestion': ' Make a Suggestion',
                'question': ' Ask a Question',
                'other': ' Report Other Issue'
            };
            
            title.textContent = titles[type] || 'Report Issue';
            
            modal.style.display = 'flex';
        }

        function closeReportModal() {
            document.getElementById('report-modal-overlay').style.display = 'none';
            document.getElementById('report-form').reset();
        }

        // Handle report form submission
        document.getElementById('report-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const reportData = {
                type: formData.get('report-type') || document.getElementById('report-type').value,
                priority: formData.get('report-priority') || document.getElementById('report-priority').value,
                description: formData.get('report-description') || document.getElementById('report-description').value,
                steps: formData.get('report-steps') || document.getElementById('report-steps').value,
                email: formData.get('report-email') || document.getElementById('report-email').value,
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                url: window.location.href
            };
            
            // Send report to development team
            sendReportToDevTeam(reportData);
            
            // Show success message
            alert('Thank you for your report! We\'ll review it and get back to you if needed.');
            
            // Close modal
            closeReportModal();
        });

        function sendReportToDevTeam(reportData) {
            // In a real implementation, this would send to development@cognisint.com
            // For now, we'll log it and store locally
            console.log('Report submitted:', reportData);
            
            // Store in local storage for now (in real implementation, send to server)
            const reports = JSON.parse(localStorage.getItem('betaReports') || '[]');
            reports.push(reportData);
            localStorage.setItem('betaReports', JSON.stringify(reports));
            
            // In real implementation, this would be:
            // fetch('/api/reports', {
            //     method: 'POST',
            //     headers: { 'Content-Type': 'application/json' },
            //     body: JSON.stringify(reportData)
            // });
        }

        // Browser Detection and Warnings
        async function detectBrowser() {
            const userAgent = navigator.userAgent;
            const isChrome = /Chrome/.test(userAgent) && /Google Inc/.test(navigator.vendor);
            const isSafari = /Safari/.test(userAgent) && /Apple Computer/.test(navigator.vendor);
            const isFirefox = /Firefox/.test(userAgent);
            const isEdge = /Edg/.test(userAgent);
            const isOpera = /Opera/.test(userAgent) || /OPR/.test(userAgent);
            const isBrave = navigator.brave ? await navigator.brave.isBrave() : false;
            const isDuckDuckGo = /DuckDuckGo/.test(userAgent);
            const isComet = /Comet/.test(userAgent);
            
            return {
                isChrome,
                isSafari,
                isFirefox,
                isEdge,
                isOpera,
                isBrave,
                isDuckDuckGo,
                isComet,
                isSupported: isSafari || isFirefox || isEdge || isOpera || isBrave || isDuckDuckGo || isComet
            };
        }

        async function showBrowserWarnings() {
            const browser = await detectBrowser();
            
            if (!browser.isSupported) {
                document.getElementById('browser-warning').classList.add('show');
            }
            
            if (browser.isChrome) {
                // Check if Chrome advisory was snoozed
                const snoozeDate = localStorage.getItem('chromeAdvisorySnooze');
                if (!snoozeDate || new Date() > new Date(snoozeDate)) {
                    document.getElementById('chrome-advisory').classList.add('show');
                }
            }
        }

        function closeBrowserWarning() {
            document.getElementById('browser-warning').classList.remove('show');
        }

        function closeChromeAdvisory() {
            document.getElementById('chrome-advisory').classList.remove('show');
        }

        function snoozeChromeAdvisory() {
            const snoozeDate = new Date();
            snoozeDate.setDate(snoozeDate.getDate() + 30);
            localStorage.setItem('chromeAdvisorySnooze', snoozeDate.toISOString());
            document.getElementById('chrome-advisory').classList.remove('show');
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            makeAdminButtonDraggable();
            showBrowserWarnings();
            updateClioStatus();
            setInterval(updateClioStatus, 30000);
            
            // Add widget classes for positioning rules
            const priorityWidget = document.getElementById('priority-ticker-widget');
            if (priorityWidget) {
                priorityWidget.classList.add('priority-widget');
            }
            
            const goodcounselWidget = document.querySelector('.widget.goodcounsel');
            if (goodcounselWidget) {
                goodcounselWidget.classList.add('goodcounsel-widget');
            }
            
            const focusWidget = document.querySelector('.widget.focus');
            if (focusWidget) {
                focusWidget.classList.add('focus-widget');
            }
            
            const performanceWidget = document.querySelector('.widget.performance');
            if (performanceWidget) {
                performanceWidget.classList.add('secondary-widget');
            }
            
            // Add workflow-widget class to all workflow stages
            const workflowStages = document.querySelectorAll('.workflow-stage');
            workflowStages.forEach(stage => {
                stage.classList.add('workflow-widget');
            });
        });

        function setClioStatusUI(status) {
            const dot = document.getElementById('clio-status-dot');
            if (!dot) return;
            dot.classList.remove('success', 'warning', 'processing');
            if (status.connected) dot.classList.add('success');
            else dot.classList.add('warning');
            const panelEl = document.getElementById('clio-connection-status');
            if (panelEl) {
                panelEl.textContent = status.message || (status.connected ? 'Connected' : 'API key required');
            }
        }

        async function updateClioStatus() {
            try {
                const res = await fetch('http://localhost:5002/api/tools/clio_integration', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'status' })
                });
                const data = await res.json();
                setClioStatusUI({ connected: !!data.connected, message: data.message });
            } catch (e) {
                setClioStatusUI({ connected: false, message: 'Clio service unavailable' });
            }
        }

        function submitBetaChecklist() {
            const selected = document.querySelector('#beta-checklist input[type="radio"]:checked');
            if (!selected) return alert('Select an issue type.');
            openReportModal(selected.value);
            setTimeout(() => {
                const desc = document.getElementById('report-description');
                if (desc) desc.value = `[Category: ${selected.value}]\n` + (desc.value || '');
            }, 50);
        }
    </script>
</body>
</html>

